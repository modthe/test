<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kahoot FS - Interactive Quiz Platform</title>
    <style>
        :root {
            --primary: #471AAA;
            --secondary: #FF6B6B;
            --accent: #4ECDC4;
            --background: #F7F9FC;
            --surface: #FFFFFF;
            --text: #2D3748;
            --text-light: #718096;
            --correct: #48BB78;
            --incorrect: #F56565;
            --warning: #ED8936;
            --info: #4299E1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, #6B46C1 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 95%;
            max-width: 1200px;
            background: var(--surface);
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, #6B46C1 100%);
            color: white;
            padding: 1.5rem 2rem;
            text-align: center;
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            flex-wrap: wrap;
        }

        .header-title {
            flex: 1;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .stats-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .tabs {
            display: flex;
            background: var(--surface);
            border-bottom: 2px solid #E2E8F0;
            position: sticky;
            top: 0;
            z-index: 100;
            flex-wrap: nowrap;
            overflow-x: auto;
        }

        .tab {
            padding: 1.2rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            flex: 1;
            font-size: 1rem;
            min-width: 140px;
            white-space: nowrap;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #F7FAFC;
            color: var(--primary);
        }

        .tab.active {
            background: var(--surface);
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .content {
            padding: 2rem;
            min-height: 500px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
        }

        h2 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        h3 {
            font-size: 1.4rem;
            color: var(--secondary);
            margin: 1.2rem 0 0.8rem;
            font-weight: 600;
        }

        input, button, select, textarea {
            padding: 0.9rem 1.2rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border: 1px solid #CBD5E0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input, select, textarea {
            width: 100%;
            max-width: 350px;
            background: var(--surface);
            color: var(--text);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(71, 26, 170, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            background: #3A0D8F;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(71, 26, 170, 0.3);
        }

        button:disabled {
            background: #A0AEC0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #E53E3E;
        }

        .btn-accent {
            background: var(--accent);
        }

        .btn-accent:hover {
            background: #38B2AC;
        }

        /* Enhanced answer button styles */
        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 2rem 0;
        }

        .answer-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin: 0;
            padding: 2rem;
            background: var(--surface);
            color: var(--text);
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            font-weight: 600;
            min-height: 120px;
            word-wrap: break-word;
            hyphens: auto;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .answer-btn:hover {
            background: #F7FAFC;
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        /* INSTANT COLOR FEEDBACK */
        .answer-btn.correct {
            background-color: var(--correct) !important;
            color: white !important;
            border-color: var(--correct) !important;
            transform: scale(1.03);
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
        }

        .answer-btn.incorrect {
            background-color: var(--incorrect) !important;
            color: white !important;
            border-color: var(--incorrect) !important;
            transform: scale(1.03);
            box-shadow: 0 8px 25px rgba(245, 101, 101, 0.4);
        }

        .answer-btn:disabled {
            opacity: 0.7;
            pointer-events: none;
        }

        .answer-btn.other-option {
            opacity: 0.6;
            background: #EDF2F7;
        }

        /* Celebration Styles */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.7);
            animation: fadeIn 0.5s ease;
        }

        .celebration-content {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            max-width: 500px;
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .celebration-title {
            font-size: 2.8rem;
            margin-bottom: 1rem;
            color: var(--correct);
            font-weight: bold;
        }

        .celebration-message {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--text);
        }

        .encouragement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 1.8rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1500;
            animation: slideUp 0.5s ease;
            max-width: 450px;
        }

        @keyframes slideUp {
            0% { transform: translate(-50%, -30%); opacity: 0; }
            100% { transform: translate(-50%, -50%); opacity: 1; }
        }

        .encouragement-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .encouragement-message {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .encouragement.correct {
            border-left: 6px solid var(--correct);
        }

        .encouragement.incorrect {
            border-left: 6px solid var(--incorrect);
        }

        /* Rank Display Styles */
        .rank-display {
            position: fixed;
            top: 120px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border-left: 5px solid var(--primary);
            z-index: 1000;
            min-width: 220px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .rank-display.celebrate {
            animation: pulse 1.5s infinite;
            border-left-color: #FFD700 !important;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
            50% { transform: scale(1.05); box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4); }
            100% { transform: scale(1); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        }

        /* Final Rank Display */
        .final-rank-section {
            background: linear-gradient(135deg, var(--primary) 0%, #6B46C1 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* Question Progress */
        .question-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            background: #EDF2F7;
            padding: 10px;
            border-radius: 10px;
        }

        .progress-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-weight: 600;
            color: var(--text-light);
        }

        .progress-item.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        /* Countdown timer */
        .countdown {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--primary);
            padding: 15px;
            background: #EDF2F7;
            border-radius: 10px;
        }

        /* Instructions */
        .instructions {
            background: #FFF8E6;
            border-left: 4px solid var(--warning);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .instructions h3 {
            color: var(--warning);
            margin-bottom: 1rem;
        }

        .instructions ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .instructions li {
            margin-bottom: 0.8rem;
            line-height: 1.5;
        }

        /* Responsive design for mobile */
        @media (max-width: 768px) {
            .answers-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .answer-btn {
                padding: 1.5rem;
                min-height: 100px;
                font-size: 1.1rem;
            }

            header {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .stats-container {
                width: 100%;
                justify-content: space-between;
            }

            .stat-box {
                min-width: 45%;
            }

            .rank-display {
                position: relative;
                top: auto;
                right: auto;
                margin: 1rem 0;
                width: 100%;
            }

            .content {
                padding: 1.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.6rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 12px;
            }

            .card {
                padding: 1.5rem;
                margin: 1rem 0;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .celebration-content {
                margin: 1rem;
                padding: 2rem;
            }

            .celebration-title {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>Kahoot FS</h1>
                    <p class="subtitle">Interactive Learning Platform</p>
                </div>
                <div class="stats-container">
                    <div class="stat-box">
                        ‚è±Ô∏è <span id="quiz-timer">Starts in: --:--</span>
                    </div>
                    <div class="stat-box">
                        üë§ <span id="current-player-count">0</span> Players
                    </div>
                </div>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('player')">Player</div>
            <div class="tab" onclick="switchTab('host')">Host</div>
            <div class="tab" onclick="switchTab('results')">Results</div>
        </div>

        <div class="content">
            <!-- Player Tab -->
            <div id="player" class="tab-content active">
                <h2>Join The Quiz</h2>
                <div class="card">
                    <div class="question-progress">
                        <div class="progress-item active">Join</div>
                        <div class="progress-item">Play</div>
                        <div class="progress-item">Results</div>
                    </div>
                    
                    <input id="player-code" placeholder="Enter your access code">
                    <input id="player-name" placeholder="Enter your name">
                    <button id="joinBtn">Join Game</button>

                    <div id="player-question"></div>
                    <div id="countdown" class="countdown"></div>
                    <div id="player-answers"></div>
                </div>

                <div class="instructions">
                    <h3>How to Play</h3>
                    <ol>
                        <li>Enter your access code and name</li>
                        <li>Click "Join Game" to enter the quiz</li>
                        <li>Answer questions before time runs out</li>
                        <li>Earn points for correct and fast answers</li>
                        <li>Compete with other players on the leaderboard</li>
                    </ol>
                </div>
            </div>

            <!-- Host Tab -->
            <div id="host" class="tab-content">
                <h2>Quiz Host Dashboard</h2>
                <div class="card">
                    <h3>Quiz Controls</h3>
                    <button id="startQuizBtn">Start Quiz</button>
                    <button id="pauseQuizBtn" class="btn-secondary">Pause Quiz</button>
                    <button id="endQuizBtn" class="btn-accent">End Quiz</button>
                    
                    <div style="margin-top: 20px;">
                        <h3>Current Players</h3>
                        <div id="players-list"></div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Add Question</h3>
                    <textarea id="question-text" placeholder="Enter your question"></textarea>
                    <input type="text" id="option1" placeholder="Option 1">
                    <input type="text" id="option2" placeholder="Option 2">
                    <input type="text" id="option3" placeholder="Option 3">
                    <input type="text" id="option4" placeholder="Option 4">
                    <select id="correct-answer">
                        <option value="0">Option 1 is correct</option>
                        <option value="1">Option 2 is correct</option>
                        <option value="2">Option 3 is correct</option>
                        <option value="3">Option 4 is correct</option>
                    </select>
                    <button id="addQuestionBtn">Add Question</button>
                </div>
            </div>

            <!-- Results Tab -->
            <div id="results" class="tab-content">
                <h2>Quiz Results</h2>
                <div class="card">
                    <h3>Leaderboard</h3>
                    <div id="leaderboard"></div>
                </div>
                
                <div class="card">
                    <h3>Your Performance</h3>
                    <div id="player-stats"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quiz data and state
        const quizData = {
            questions: [
                {
                    question: "What is the capital of France?",
                    options: ["London", "Berlin", "Paris", "Madrid"],
                    correct: 2,
                    time: 20
                },
                {
                    question: "Which planet is known as the Red Planet?",
                    options: ["Venus", "Mars", "Jupiter", "Saturn"],
                    correct: 1,
                    time: 15
                },
                {
                    question: "What is the largest mammal in the world?",
                    options: ["Elephant", "Blue Whale", "Giraffe", "Polar Bear"],
                    correct: 1,
                    time: 20
                },
                {
                    question: "Who painted the Mona Lisa?",
                    options: ["Van Gogh", "Picasso", "Da Vinci", "Monet"],
                    correct: 2,
                    time: 15
                }
            ],
            players: [],
            currentQuestion: 0,
            isActive: false,
            timer: null,
            timeLeft: 0
        };

        // Player data
        let player = {
            id: null,
            name: "",
            score: 0,
            answers: [],
            currentRank: 0
        };

        // DOM Elements
        const playerCodeInput = document.getElementById('player-code');
        const playerNameInput = document.getElementById('player-name');
        const joinBtn = document.getElementById('joinBtn');
        const playerQuestionDiv = document.getElementById('player-question');
        const countdownDiv = document.getElementById('countdown');
        const playerAnswersDiv = document.getElementById('player-answers');
        const quizTimerSpan = document.getElementById('quiz-timer');
        const playerCountSpan = document.getElementById('current-player-count');
        const playersListDiv = document.getElementById('players-list');
        const leaderboardDiv = document.getElementById('leaderboard');
        const playerStatsDiv = document.getElementById('player-stats');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const pauseQuizBtn = document.getElementById('pauseQuizBtn');
        const endQuizBtn = document.getElementById('endQuizBtn');
        const addQuestionBtn = document.getElementById('addQuestionBtn');

        // Celebration messages
        const celebrationMessages = [
            "Amazing! You're a quiz master! üéâ",
            "Brilliant! That was the right answer! ‚ú®",
            "Fantastic! You're on fire! üî•",
            "Outstanding! You nailed it! üí™",
            "Excellent! You're crushing it! üöÄ",
            "Superb! You're unstoppable! ‚ö°"
        ];

        // Encouragement messages
        const encouragementMessages = [
            "Don't give up! You'll get the next one! üí™",
            "Almost there! Keep going! üöÄ",
            "Nice try! You're learning! üìö",
            "Good effort! The next one is yours! ‚ú®",
            "Keep pushing! You're improving! üí´"
        ];

        // Fast response messages
        const fastResponseMessages = [
            "Lightning fast! ‚ö°",
            "Incredible speed! üèÉ‚Äç‚ôÇÔ∏è",
            "Super quick! üöÄ",
            "Blazing fast! üî•",
            "Speed demon! üëπ"
        ];

        // Initialize the application
        function init() {
            // Set up event listeners
            joinBtn.addEventListener('click', joinGame);
            startQuizBtn.addEventListener('click', startQuiz);
            pauseQuizBtn.addEventListener('click', pauseQuiz);
            endQuizBtn.addEventListener('click', endQuiz);
            addQuestionBtn.addEventListener('click', addQuestion);
            
            // Initialize player count
            updatePlayerCount();
            
            // Set up quiz timer
            setQuizTimer();
            
            // Initialize leaderboard
            updateLeaderboard();
            
            console.log("Kahoot FS initialized successfully!");
        }

        // Switch between tabs
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Update tab styles
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update content based on tab
            if (tabName === 'results') {
                updateLeaderboard();
                updatePlayerStats();
            } else if (tabName === 'host') {
                updatePlayersList();
            }
        }

        // Join the game
        function joinGame() {
            const code = playerCodeInput.value.trim();
            const name = playerNameInput.value.trim();
            
            if (!code || !name) {
                alert("Please enter both your access code and name");
                return;
            }
            
            // Create player
            player.id = Math.random().toString(36).substring(2, 9);
            player.name = name;
            player.score = 0;
            player.answers = [];
            
            // Hide join form and show game
            playerCodeInput.style.display = 'none';
            playerNameInput.style.display = 'none';
            joinBtn.style.display = 'none';
            
            // Show waiting message
            playerQuestionDiv.innerHTML = `
                <h3>Welcome, ${name}!</h3>
                <p>Waiting for the quiz to start...</p>
                <div style="text-align: center; margin-top: 20px;">
                    <div style="font-size: 3rem;">‚è≥</div>
                    <p>The host will start the quiz soon</p>
                </div>
            `;
            
            // Update player count
            quizData.players.push({
                id: player.id,
                name: player.name,
                score: 0,
                isActive: true
            });
            
            updatePlayerCount();
            updatePlayersList();
            
            // Show rank display
            showRankDisplay();
        }

        // Start the quiz
        function startQuiz() {
            quizData.isActive = true;
            quizData.currentQuestion = 0;
            showQuestion();
            
            // Update UI
            startQuizBtn.disabled = true;
            pauseQuizBtn.disabled = false;
            
            // Notify players
            if (player.id) {
                playerQuestionDiv.innerHTML = `
                    <h3>Quiz Starting!</h3>
                    <p>Get ready for the first question...</p>
                `;
                
                setTimeout(() => {
                    showQuestion();
                }, 3000);
            }
        }

        // Show current question
        function showQuestion() {
            if (!quizData.isActive || quizData.currentQuestion >= quizData.questions.length) {
                endQuiz();
                return;
            }
            
            const question = quizData.questions[quizData.currentQuestion];
            quizData.timeLeft = question.time;
            
            // Display question
            playerQuestionDiv.innerHTML = `
                <h3>Question ${quizData.currentQuestion + 1} of ${quizData.questions.length}</h3>
                <p>${question.question}</p>
            `;
            
            // Display options
            playerAnswersDiv.innerHTML = '';
            const grid = document.createElement('div');
            grid.className = 'answers-grid';
            
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = option;
                btn.onclick = () => selectAnswer(index);
                grid.appendChild(btn);
            });
            
            playerAnswersDiv.appendChild(grid);
            
            // Start countdown
            startCountdown();
        }

        // Start countdown timer
        function startCountdown() {
            countdownDiv.textContent = `Time left: ${quizData.timeLeft}s`;
            countdownDiv.style.display = 'block';
            
            clearInterval(quizData.timer);
            quizData.timer = setInterval(() => {
                quizData.timeLeft--;
                countdownDiv.textContent = `Time left: ${quizData.timeLeft}s`;
                
                if (quizData.timeLeft <= 0) {
                    clearInterval(quizData.timer);
                    timeUp();
                }
            }, 1000);
        }

        // Time's up
        function timeUp() {
            // Disable all answer buttons
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            // Show correct answer
            const question = quizData.questions[quizData.currentQuestion];
            const correctBtn = document.querySelectorAll('.answer-btn')[question.correct];
            correctBtn.classList.add('correct');
            
            // Mark player's answer as incorrect if not answered
            if (!player.answers[quizData.currentQuestion]) {
                player.answers[quizData.currentQuestion] = {
                    selected: -1,
                    correct: false,
                    time: 0
                };
                
                showEncouragement();
            }
            
            // Move to next question after delay
            setTimeout(() => {
                quizData.currentQuestion++;
                showQuestion();
            }, 3000);
        }

        // Select an answer
        function selectAnswer(selectedIndex) {
            if (!quizData.isActive) return;
            
            // Calculate time taken
            const timeTaken = quizData.questions[quizData.currentQuestion].time - quizData.timeLeft;
            
            // Stop the timer
            clearInterval(quizData.timer);
            
            // Disable all buttons
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            // Check if answer is correct
            const question = quizData.questions[quizData.currentQuestion];
            const isCorrect = selectedIndex === question.correct;
            
            // Show visual feedback
            document.querySelectorAll('.answer-btn').forEach((btn, index) => {
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex && !isCorrect) {
                    btn.classList.add('incorrect');
                } else {
                    btn.classList.add('other-option');
                }
            });
            
            // Store player's answer
            player.answers[quizData.currentQuestion] = {
                selected: selectedIndex,
                correct: isCorrect,
                time: timeTaken
            };
            
            // Update score
            if (isCorrect) {
                // Calculate points based on speed (faster = more points)
                const timeBonus = Math.max(5, 20 - timeTaken);
                player.score += timeBonus;
                
                // Show celebration
                showCelebration(timeTaken, timeTaken < 5);
            } else {
                showEncouragement();
            }
            
            // Update rank display
            updateRankDisplay();
            
            // Move to next question after delay
            setTimeout(() => {
                quizData.currentQuestion++;
                showQuestion();
            }, 3000);
        }

        // Show celebration for correct answer
        function showCelebration(responseTime, isFast = false) {
            const existingCelebration = document.querySelector('.celebration');
            if (existingCelebration) {
                existingCelebration.remove();
            }

            const celebration = document.createElement('div');
            celebration.className = 'celebration';

            const randomMessage = celebrationMessages[Math.floor(Math.random() * celebrationMessages.length)];
            const fastMessage = isFast ? fastResponseMessages[Math.floor(Math.random() * fastResponseMessages.length)] : '';

            celebration.innerHTML = `
                <div class="celebration-content">
                    <div class="celebration-title">üéâ Correct! üéâ</div>
                    <div class="celebration-message">${randomMessage}</div>
                    ${isFast ? `<div style="font-size: 1.5rem; color: #FFD700; margin-bottom: 1rem;">${fastMessage}</div>` : ''}
                    <div style="font-size: 1rem; color: #666;">Response time: ${responseTime.toFixed(1)} seconds</div>
                    <button onclick="this.closest('.celebration').remove()" style="margin-top: 1rem; padding: 0.8rem 1.5rem; background: var(--correct); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;">Continue</button>
                </div>
            `;

            document.body.appendChild(celebration);

            // Trigger confetti
            if (typeof confetti === 'function') {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            setTimeout(() => {
                if (celebration.parentNode) {
                    celebration.remove();
                }
            }, 3000);
        }

        // Show encouragement for incorrect answer
        function showEncouragement() {
            const existingEncouragement = document.querySelector('.encouragement');
            if (existingEncouragement) {
                existingEncouragement.remove();
            }

            const encouragement = document.createElement('div');
            encouragement.className = 'encouragement incorrect';

            const randomMessage = encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)];

            encouragement.innerHTML = `
                <div class="encouragement-title">Keep Going! üí™</div>
                <div class="encouragement-message">${randomMessage}</div>
                <button onclick="this.closest('.encouragement').remove()" style="padding: 0.5rem 1rem; background: var(--incorrect); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">OK</button>
            `;

            document.body.appendChild(encouragement);

            setTimeout(() => {
                if (encouragement.parentNode) {
                    encouragement.remove();
                }
            }, 3000);
        }

        // Pause the quiz
        function pauseQuiz() {
            quizData.isActive = false;
            clearInterval(quizData.timer);
            
            // Update UI
            startQuizBtn.disabled = false;
            pauseQuizBtn.disabled = true;
            
            // Notify players
            if (player.id) {
                playerQuestionDiv.innerHTML = `
                    <h3>Quiz Paused</h3>
                    <p>The host has paused the quiz. Please wait...</p>
                `;
            }
        }

        // End the quiz
        function endQuiz() {
            quizData.isActive = false;
            clearInterval(quizData.timer);
            
            // Update UI
            startQuizBtn.disabled = false;
            pauseQuizBtn.disabled = true;
            endQuizBtn.disabled = true;
            
            // Show results to players
            if (player.id) {
                showResults();
            }
            
            // Update leaderboard
            updateLeaderboard();
        }

        // Show results to player
        function showResults() {
            const correctAnswers = player.answers.filter(a => a && a.correct).length;
            const totalQuestions = quizData.questions.length;
            const accuracy = totalQuestions > 0 ? (correctAnswers / totalQuestions * 100).toFixed(1) : 0;
            
            // Calculate average response time for correct answers
            const correctTimes = player.answers.filter(a => a && a.correct).map(a => a.time);
            const avgTime = correctTimes.length > 0 ? 
                (correctTimes.reduce((a, b) => a + b, 0) / correctTimes.length).toFixed(1) : 0;
            
            playerQuestionDiv.innerHTML = `
                <div class="final-rank-section">
                    <h2>Quiz Complete! üéâ</h2>
                    <p>Congratulations, ${player.name}!</p>
                    <div style="font-size: 3rem; font-weight: bold; margin: 20px 0;">
                        #${player.currentRank}
                    </div>
                    <p>Your Final Rank</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 25px 0;">
                    <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: bold; color: var(--correct);">${correctAnswers}</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Correct Answers</div>
                    </div>
                    <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: bold; color: var(--incorrect);">${totalQuestions - correctAnswers}</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Incorrect Answers</div>
                    </div>
                    <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">${accuracy}%</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Accuracy</div>
                    </div>
                    <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: bold; color: var(--accent);">${player.score}</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Total Score</div>
                    </div>
                </div>
            `;
            
            playerAnswersDiv.innerHTML = '';
            countdownDiv.style.display = 'none';
            
            // Remove rank display
            const rankDisplay = document.getElementById('current-rank-display');
            if (rankDisplay) {
                rankDisplay.remove();
            }
        }

        // Show rank display
        function showRankDisplay() {
            // Remove existing rank display
            const existingDisplay = document.getElementById('current-rank-display');
            if (existingDisplay) {
                existingDisplay.remove();
            }
            
            // Create new rank display
            const rankDisplay = document.createElement('div');
            rankDisplay.id = 'current-rank-display';
            rankDisplay.className = 'rank-display';
            rankDisplay.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 10px; color: var(--primary);">üèÜ Live Ranking</div>
                <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent); text-align: center;">
                    #--
                </div>
                <div style="font-size: 1rem; text-align: center; margin-bottom: 10px;">
                    ${player.name}
                </div>
                <div style="font-size: 0.9rem; color: var(--text-light);">
                    üìä Score: 0
                </div>
                <div style="font-size: 0.9rem; color: var(--text-light); margin-top: 5px;">
                    ‚ö° Avg: --
                </div>
            `;
            
            document.body.appendChild(rankDisplay);
        }

        // Update rank display
        function updateRankDisplay() {
            const rankDisplay = document.getElementById('current-rank-display');
            if (!rankDisplay) return;
            
            // Calculate player rank (simulated for demo)
            player.currentRank = Math.max(1, Math.floor(Math.random() * 10) + 1);
            
            // Calculate average response time for correct answers
            const correctTimes = player.answers.filter(a => a && a.correct).map(a => a.time);
            const avgTime = correctTimes.length > 0 ? 
                (correctTimes.reduce((a, b) => a + b, 0) / correctTimes.length).toFixed(1) : '--';
            
            rankDisplay.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 10px; color: var(--primary);">üèÜ Live Ranking</div>
                <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent); text-align: center;">
                    #${player.currentRank}
                </div>
                <div style="font-size: 1rem; text-align: center; margin-bottom: 10px;">
                    ${player.name}
                </div>
                <div style="font-size: 0.9rem; color: var(--text-light);">
                    üìä Score: ${player.score}
                </div>
                <div style="font-size: 0.9rem; color: var(--text-light); margin-top: 5px;">
                    ‚ö° Avg: ${avgTime}s
                </div>
            `;
            
            // Add celebration effect for top 3
            if (player.currentRank <= 3) {
                rankDisplay.classList.add('celebrate');
            } else {
                rankDisplay.classList.remove('celebrate');
            }
        }

        // Update player count
        function updatePlayerCount() {
            const count = quizData.players.filter(p => p.isActive).length;
            playerCountSpan.textContent = count;
        }

        // Update players list (host view)
        function updatePlayersList() {
            playersListDiv.innerHTML = '';
            
            if (quizData.players.length === 0) {
                playersListDiv.innerHTML = '<p>No players joined yet.</p>';
                return;
            }
            
            quizData.players.forEach(p => {
                const playerDiv = document.createElement('div');
                playerDiv.style.padding = '10px';
                playerDiv.style.borderBottom = '1px solid #E2E8F0';
                playerDiv.style.display = 'flex';
                playerDiv.style.justifyContent = 'space-between';
                playerDiv.innerHTML = `
                    <span>${p.name}</span>
                    <span style="font-weight: bold; color: var(--primary);">${p.score} pts</span>
                `;
                playersListDiv.appendChild(playerDiv);
            });
        }

        // Update leaderboard
        function updateLeaderboard() {
            leaderboardDiv.innerHTML = '';
            
            // Sort players by score
            const sortedPlayers = [...quizData.players].sort((a, b) => b.score - a.score);
            
            if (sortedPlayers.length === 0) {
                leaderboardDiv.innerHTML = '<p>No results yet.</p>';
                return;
            }
            
            sortedPlayers.forEach((p, index) => {
                const rank = index + 1;
                const playerDiv = document.createElement('div');
                playerDiv.style.padding = '15px';
                playerDiv.style.borderBottom = '1px solid #E2E8F0';
                playerDiv.style.display = 'flex';
                playerDiv.style.justifyContent = 'space-between';
                playerDiv.style.alignItems = 'center';
                playerDiv.style.background = rank <= 3 ? '#F0FFF4' : 'transparent';
                playerDiv.style.borderRadius = '8px';
                playerDiv.style.marginBottom = '10px';
                
                let medal = '';
                if (rank === 1) medal = 'ü•á';
                else if (rank === 2) medal = 'ü•à';
                else if (rank === 3) medal = 'ü•â';
                
                playerDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.2rem; font-weight: bold; width: 30px;">${medal || rank}</span>
                        <span>${p.name}</span>
                    </div>
                    <span style="font-weight: bold; color: var(--primary);">${p.score} pts</span>
                `;
                leaderboardDiv.appendChild(playerDiv);
            });
        }

        // Update player stats
        function updatePlayerStats() {
            if (!player.id) {
                playerStatsDiv.innerHTML = '<p>Join a quiz to see your stats.</p>';
                return;
            }
            
            const correctAnswers = player.answers.filter(a => a && a.correct).length;
            const totalQuestions = quizData.questions.length;
            const accuracy = totalQuestions > 0 ? (correctAnswers / totalQuestions * 100).toFixed(1) : 0;
            
            playerStatsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: var(--surface); padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">${player.score}</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Total Score</div>
                    </div>
                    <div style="background: var(--surface); padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--correct);">${correctAnswers}</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Correct Answers</div>
                    </div>
                    <div style="background: var(--surface); padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--incorrect);">${totalQuestions - correctAnswers}</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Incorrect Answers</div>
                    </div>
                    <div style="background: var(--surface); padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent);">${accuracy}%</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">Accuracy</div>
                    </div>
                </div>
            `;
        }

        // Add a new question
        function addQuestion() {
            const questionText = document.getElementById('question-text').value;
            const option1 = document.getElementById('option1').value;
            const option2 = document.getElementById('option2').value;
            const option3 = document.getElementById('option3').value;
            const option4 = document.getElementById('option4').value;
            const correctAnswer = parseInt(document.getElementById('correct-answer').value);
            
            if (!questionText || !option1 || !option2 || !option3 || !option4) {
                alert("Please fill in all fields");
                return;
            }
            
            const newQuestion = {
                question: questionText,
                options: [option1, option2, option3, option4],
                correct: correctAnswer,
                time: 20
            };
            
            quizData.questions.push(newQuestion);
            
            // Clear form
            document.getElementById('question-text').value = '';
            document.getElementById('option1').value = '';
            document.getElementById('option2').value = '';
            document.getElementById('option3').value = '';
            document.getElementById('option4').value = '';
            
            alert("Question added successfully!");
        }

        // Set quiz timer
        function setQuizTimer() {
            // For demo purposes, set a random time
            const minutes = Math.floor(Math.random() * 5) + 1;
            const seconds = Math.floor(Math.random() * 60);
            quizTimerSpan.textContent = `Starts in: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
