<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Game with Admin Features</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
/* Your CSS remains unchanged */
</style>
</head>
<body>
<div class="container">
<!-- Your HTML remains unchanged -->
</div>

<script>
// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyDnt-BAUsCbQMZ-PPALhp3_tsYqcHAKEZ8",
  authDomain: "thequizfs.firebaseapp.com",
  databaseURL: "https://thequizfs-default-rtdb.firebaseio.com",
  projectId: "thequizfs",
  storageBucket: "thequizfs.firebasestorage.app",
  messagingSenderId: "16144411406",
  appId: "1:16144411406:web:d83affb2013dea665e055f",
  measurementId: "G-NXX4GQZ4NF"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Tab switching functionality
function switchTab(tabName) {
  // Hide all tab contents
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });

  // Show selected tab content
  document.getElementById(tabName).classList.add('active');

  // Update active tab
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });

  // Activate the clicked tab
  event.target.classList.add('active');

  // If switching to host tab, load the saved time settings
  if (tabName === 'host') {
    loadHostTimeSettings();
  }
}

// Initialize variables
var questions = [];
var currentIndex = 0;
var playerName = "";
var countdownInterval;
var timeLeft = 15;
var questionStartTime;
var quizActive = false;
var adminCode = "admin123"; // Default admin code
var webAppUrl = ""; // Will be loaded from Firebase

// Quiz timing configuration (default: tomorrow 12:00 PM to 12:30 PM)
var quizStartTime = localStorage.getItem('quizStartTime');
var quizEndTime = localStorage.getItem('quizEndTime');

if (!quizStartTime) {
  // Set default to tomorrow at 12:00 PM
  var tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  tomorrow.setHours(12, 0, 0, 0);
  quizStartTime = tomorrow.getTime();
  localStorage.setItem('quizStartTime', quizStartTime);
} else {
  quizStartTime = parseInt(quizStartTime);
}

if (!quizEndTime) {
  // Set default to tomorrow at 12:30 PM
  var endTime = new Date(quizStartTime);
  endTime.setMinutes(endTime.getMinutes() + 30);
  quizEndTime = endTime.getTime();
  localStorage.setItem('quizEndTime', quizEndTime);
} else {
  quizEndTime = parseInt(quizEndTime);
}

// Load data from Firebase
function loadDataFromFirebase() {
  // Listen for quiz time changes
  database.ref('quizTime').on('value', (snapshot) => {
    const data = snapshot.val();
    if (data) {
      quizStartTime = data.startTime;
      quizEndTime = data.endTime;
      localStorage.setItem('quizStartTime', quizStartTime);
      localStorage.setItem('quizEndTime', quizEndTime);
      updateQuizTimeInfo();
      console.log("Quiz time updated from Firebase");
    }
  }, (error) => {
    console.error("Firebase read failed:", error);
  });

  // Listen for question changes
  database.ref('questions').on('value', (snapshot) => {
    const data = snapshot.val();
    if (data) {
      questions = Object.values(data);
      localStorage.setItem('quizQuestions', JSON.stringify(questions));
      displayQuestions();
      console.log("Questions updated from Firebase");
      
      // If we're on the player tab and a question is active, update it
      if (document.getElementById('player').classList.contains('active') && 
          document.getElementById('player-question').innerHTML !== "") {
        showPlayerQuestion();
      }
    }
  }, (error) => {
    console.error("Firebase read failed:", error);
  });

  // Listen for Google Sheets URL changes
  database.ref('webAppUrl').on('value', (snapshot) => {
    const url = snapshot.val();
    if (url) {
      webAppUrl = url;
      localStorage.setItem('webAppUrl', webAppUrl);
      document.getElementById('webAppUrl').value = webAppUrl;
      
      // Hide setup tab if URL is configured
      if (webAppUrl) {
        document.getElementById('setup-tab').style.display = 'none';
        document.getElementById('setup-form').style.display = 'none';
        document.getElementById('setup-complete-message').style.display = 'block';
      }
      
      console.log("Web app URL updated from Firebase");
    }
  }, (error) => {
    console.error("Firebase read failed:", error);
  });
}

// Save web app URL to Firebase
function saveWebAppUrlToFirebase(url) {
  database.ref('webAppUrl').set(url).then(() => {
    document.getElementById('urlStatus').textContent = 'URL saved successfully! Setup complete.';
    document.getElementById('urlStatus').className = 'url-status success';
  }).catch((error) => {
    document.getElementById('urlStatus').textContent = 'Error saving URL: ' + error.message;
    document.getElementById('urlStatus').className = 'url-status error';
  });
}

// Save web app URL to local storage and Firebase
function saveWebAppUrl() {
  var url = document.getElementById('webAppUrl').value;
  var urlStatus = document.getElementById('urlStatus');

  if (url) {
    // Save to Firebase
    saveWebAppUrlToFirebase(url);
    
    // Hide setup form and show completion message
    document.getElementById('setup-form').style.display = 'none';
    document.getElementById('setup-complete-message').style.display = 'block';

    // Hide setup tab
    document.getElementById('setup-tab').style.display = 'none';
  } else {
    urlStatus.textContent = 'Please enter a valid URL';
    urlStatus.className = 'url-status error';
  }
}

// Function to send data to Google Sheets
function sendToGoogleSheet(playerName, question, selectedAnswer, correctAnswer, responseTime, status) {
  if (!webAppUrl) {
    console.error("Web app URL not configured");
    return;
  }

  // Prepare data to send
  var data = {
    player: playerName,
    question: question,
    answer: selectedAnswer,
    correct: correctAnswer,
    responseTime: responseTime,
    status: status
  };

  // Send data to Google Apps Script web app
  fetch(webAppUrl, {
    method: "POST",
    mode: "no-cors",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  })
  .then(() => {
    console.log("Data sent to Google Sheets successfully");
  })
  .catch(error => {
    console.error("Error sending data to Google Sheets:", error);
  });
}

// The rest of your JavaScript code remains the same, except for the initialization part:

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
  // Try to load from localStorage first for immediate display
  var savedStartTime = localStorage.getItem('quizStartTime');
  var savedEndTime = localStorage.getItem('quizEndTime');
  var savedQuestions = localStorage.getItem('quizQuestions');
  var savedWebAppUrl = localStorage.getItem('webAppUrl');
  
  if (savedStartTime) quizStartTime = parseInt(savedStartTime);
  if (savedEndTime) quizEndTime = parseInt(savedEndTime);
  if (savedQuestions) questions = JSON.parse(savedQuestions);
  if (savedWebAppUrl) {
    webAppUrl = savedWebAppUrl;
    document.getElementById('webAppUrl').value = webAppUrl;
  }
  
  // Then load from Firebase (will override localStorage if newer)
  loadDataFromFirebase();
  
  // Check if web app URL is configured
  if (!webAppUrl) {
    console.log("Web app URL not configured. Please set it up in the Setup tab.");
    // Show setup tab if no URL is configured
    document.getElementById('setup-tab').style.display = 'flex';
  } else {
    // Hide setup tab if URL is configured
    document.getElementById('setup-tab').style.display = 'none';
    document.getElementById('setup-form').style.display = 'none';
    document.getElementById('setup-complete-message').style.display = 'block';
  }
  
  // Initialize the quiz time display
  updateQuizTimeInfo();
});

// The rest of your functions (saveHostQuizTime, addQuestion, etc.) remain unchanged
</script>
</body>
</html>
