<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<!-- Excel Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
background: linear-gradient(135deg, #1a3a5f 0%, #2c5c8a 100%);
color: #333;
line-height: 1.6;
min-height: 100vh;
padding: 20px;
display: flex;
justify-content: center;
align-items: center;
}

.container {
width: 95%;
max-width: 1200px;
background: white;
border-radius: 12px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
overflow: hidden;
}

header {
background: linear-gradient(135deg, #1a3a5f, #2c5c8a);
color: white;
padding: 1.5rem;
text-align: center;
position: relative;
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
}

.header-content {
display: flex;
justify-content: space-between;
align-items: center;
width: 100%;
flex-wrap: wrap;
}

.header-title {
flex: 1;
text-align: center;
}

.quiz-timer {
background: rgba(255, 255, 255, 0.2);
padding: 8px 15px;
border-radius: 20px;
font-weight: bold;
font-size: 0.9rem;
display: flex;
align-items: center;
gap: 8px;
min-width: 180px;
justify-content: center;
}

.player-count {
background: rgba(255, 255, 255, 0.3);
padding: 8px 15px;
border-radius: 20px;
font-weight: bold;
font-size: 0.9rem;
display: flex;
align-items: center;
gap: 8px;
min-width: 180px;
justify-content: center;
}

.player-count.active {
background: rgba(76, 175, 80, 0.3);
animation: pulse 2s infinite;
}

@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}

h1 {
font-size: 2rem;
margin-bottom: 0.5rem;
}

.subtitle {
font-size: 1rem;
opacity: 0.9;
}

.tabs {
display: flex;
background: #f0f0f0;
border-bottom: 2px solid #ddd;
position: sticky;
top: 0;
z-index: 100;
flex-wrap: nowrap;
overflow-x: auto;
}

.tab {
padding: 1rem;
cursor: pointer;
font-weight: 600;
transition: all 0.3s ease;
text-align: center;
flex: 1;
font-size: 0.9rem;
min-width: 120px;
white-space: nowrap;
}

.tab:hover {
background: #e0e0e0;
}

.tab.active {
background: white;
border-bottom: 3px solid #1a3a5f;
}

.content {
padding: 1.5rem;
min-height: 500px;
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

.card {
background: white;
border-radius: 10px;
padding: 1.5rem;
margin: 1.5rem 0;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
border-left: 4px solid #1a3a5f;
}

h2 {
font-size: 1.6rem;
color: #1a3a5f;
margin-bottom: 1rem;
}

h3 {
font-size: 1.3rem;
color: #2c5c8a;
margin: 1.2rem 0 0.8rem;
}

input, button, select, textarea {
padding: 0.8rem 1rem;
margin: 0.5rem 0;
border-radius: 5px;
border: 1px solid #ddd;
font-size: 0.9rem;
}

input, select, textarea {
width: 100%;
max-width: 300px;
}

textarea {
min-height: 100px;
resize: vertical;
}

button {
background: #1a3a5f;
color: white;
border: none;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 600;
}

button:hover {
background: #2c5c8a;
transform: translateY(-2px);
}

button:disabled {
background: #ccc;
cursor: not-allowed;
transform: none;
}

.answers-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
margin: 1.5rem 0;
}

.answer-btn {
display: flex;
align-items: center;
justify-content: center;
text-align: center;
margin: 0;
padding: 1.5rem;
background: #f8f9fa;
color: #333;
border: 2px solid #ddd;
border-radius: 10px;
transition: all 0.3s ease;
font-size: 1.1rem;
font-weight: 500;
min-height: 100px;
word-wrap: break-word;
hyphens: auto;
cursor: pointer;
position: relative;
}

.answer-btn:hover {
background: #e9ecef;
transform: translateY(-3px);
border-color: #1a3a5f;
box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.answer-btn.correct {
background-color: #4caf50 !important;
color: white !important;
border-color: #4caf50 !important;
transform: scale(1.03);
box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
}

.answer-btn.incorrect {
background-color: #f44336 !important;
color: white !important;
border-color: #f44336 !important;
transform: scale(1.03);
box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
}

.answer-btn:disabled {
opacity: 0.7;
pointer-events: none;
}

.answer-btn.other-option {
opacity: 0.6;
background: #f0f0f0;
}

@media (max-width: 768px) {
.answers-grid {
grid-template-columns: 1fr;
gap: 15px;
}

.answer-btn {
padding: 1.2rem;
min-height: 80px;
font-size: 1rem;
}

header {
padding: 1rem;
}

.header-content {
flex-direction: column;
gap: 10px;
}

.quiz-timer, .player-count {
min-width: 100%;
}
}

.instructions {
background: #fff8e1;
border-left: 4px solid #ffc107;
padding: 1.2rem;
margin: 1.5rem 0;
border-radius: 4px;
}

.instructions h3 {
color: #ff9800;
margin-bottom: 0.8rem;
}

.instructions ol {
margin-right: 1.5rem;
margin-bottom: 1rem;
}

.instructions li {
margin-bottom: 0.5rem;
}

.countdown {
font-size: 1.4rem;
font-weight: bold;
text-align: center;
margin: 1rem 0;
color: #1a3a5f;
}

.url-status {
margin-top: 10px;
padding: 8px;
border-radius: 4px;
text-align: center;
font-size: 0.9rem;
}

.url-status.success {
background-color: #d4edda;
color: #155724;
border: 1px solid #c3e6cb;
}

.url-status.error {
background-color: #f8d7da;
color: #721c24;
border: 1px solid #f5c6cb;
}

.setup-complete {
text-align: center;
padding: 1.5rem;
background: #e8f5e9;
border-radius: 8px;
margin: 1.5rem 0;
}

.time-info {
background: #e3f2fd;
border-left: 4px solid #2196f3;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.time-config {
background: #f3e5f5;
border-left: 4px solid #9c27b0;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.time-config h3 {
color: #7b1fa2;
}

.form-group {
margin: 1rem 0;
}

label {
display: block;
margin-bottom: 0.5rem;
font-weight: 600;
}

.admin-section {
background: #fff3e0;
border-left: 4px solid #ff9800;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.admin-section h3 {
color: #ef6c00;
}

.question-list {
margin: 1rem 0;
max-height: 300px;
overflow-y: auto;
border: 1px solid #ddd;
border-radius: 5px;
padding: 1rem;
background: #f9f9f9;
}

.question-item {
padding: 0.5rem;
border-bottom: 1px solid #eee;
}

.question-item:last-child {
border-bottom: none;
}

.admin-controls {
display: flex;
gap: 10px;
margin-top: 0.5rem;
flex-wrap: wrap;
}

.admin-btn {
padding: 0.5rem 1rem;
font-size: 0.8rem;
}

.admin-btn.edit {
background: #ff9800;
}

.admin-btn.toggle {
background: #9c27b0;
}

.admin-btn.delete {
background: #f44336;
}

.answer-option {
display: flex;
align-items: center;
margin-bottom: 0.5rem;
gap: 10px;
}

.answer-option input[type="text"] {
flex: 1;
max-width: none;
}

.response-time {
font-style: italic;
color: #666;
font-size: 0.9rem;
margin-top: 5px;
}

.time-input-group {
display: flex;
align-items: center;
gap: 10px;
flex-wrap: wrap;
}

.time-input-group input {
max-width: 100px;
}

.time-input-group select {
max-width: 100px;
}

.firebase-config-help {
background: #ffebee;
border-left: 4px solid #f44336;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.firebase-config-help h3 {
color: #c62828;
}

.stats-container {
background: #f5f5f5;
padding: 1rem;
border-radius: 8px;
margin-bottom: 1rem;
}

.stats-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 1rem;
margin-top: 1rem;
}

.stat-card {
background: white;
padding: 1rem;
border-radius: 8px;
text-align: center;
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-number {
display: block;
font-size: 1.8rem;
font-weight: bold;
color: #1a3a5f;
}

.stat-label {
font-size: 0.8rem;
color: #666;
}

.results-table {
margin-top: 1rem;
border: 1px solid #ddd;
border-radius: 5px;
overflow: auto;
max-height: 400px;
}

.result-header, .result-row {
display: grid;
grid-template-columns: 1fr 2fr 1fr 1fr 1fr 1fr 2fr;
gap: 1px;
padding: 0.5rem;
min-width: 800px;
}

.result-header {
background: #1a3a5f;
color: white;
font-weight: bold;
position: sticky;
top: 0;
}

.result-row {
background: #f9f9f9;
border-bottom: 1px solid #eee;
}

.result-row.correct {
background: #e8f5e9;
}

.result-row.incorrect {
background: #ffebee;
}

.result-row:last-child {
border-bottom: none;
}

.export-buttons {
display: flex;
gap: 10px;
margin: 1rem 0;
flex-wrap: wrap;
}

.export-btn {
background: #4caf50;
padding: 0.8rem 1.2rem;
}

.export-btn.csv {
background: #2196f3;
}

.export-btn.delete {
background: #f44336;
}

#admin-features {
max-height: 70vh;
overflow-y: auto;
}

.security-notice {
background: #e3f2fd;
border-left: 4px solid #2196f3;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
font-size: 0.9rem;
}

.security-notice h4 {
color: #1565c0;
margin-bottom: 0.5rem;
}

.question-toggle {
background: #ff9800;
padding: 0.3rem 0.8rem;
font-size: 0.8rem;
margin-right: 10px;
}

.question-toggle.hidden {
background: #f44336;
}

.question-item.hidden {
opacity: 0.6;
background: #f5f5f5;
border-left: 4px solid #ff9800;
}

.status-badge {
display: inline-block;
padding: 0.2rem 0.5rem;
border-radius: 12px;
font-size: 0.7rem;
font-weight: bold;
margin-right: 10px;
}

.status-visible {
background: #4caf50;
color: white;
}

.status-hidden {
background: #f44336;
color: white;
}

.player-results {
text-align: center;
padding: 2rem;
background: #f8f9fa;
border-radius: 10px;
margin: 1rem 0;
}

.result-stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 1rem;
margin: 2rem 0;
}

.result-stat {
background: white;
padding: 1.5rem;
border-radius: 8px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.result-number {
font-size: 2.5rem;
font-weight: bold;
display: block;
}

.result-correct { color: #4caf50; }
.result-incorrect { color: #f44336; }
.result-accuracy { color: #2196f3; }
.result-time { color: #ff9800; }

.result-label {
font-size: 0.9rem;
color: #666;
margin-top: 0.5rem;
}

.download-btn {
background: #4caf50;
padding: 1rem 2rem;
font-size: 1.1rem;
margin: 1rem;
}

.download-btn:hover {
background: #45a049;
transform: translateY(-2px);
}

.session-warning {
background: #fff3cd;
border-left: 4px solid #ffc107;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
text-align: center;
}

.session-warning h3 {
color: #856404;
margin-bottom: 0.5rem;
}

.user-management {
background: #e8f5e9;
border-left: 4px solid #4caf50;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.user-management h3 {
color: #2e7d32;
}

.user-list {
margin: 1rem 0;
max-height: 300px;
overflow-y: auto;
border: 1px solid #ddd;
border-radius: 5px;
padding: 1rem;
background: #f9f9f9;
}

.user-item {
padding: 0.8rem;
border-bottom: 1px solid #eee;
display: flex;
justify-content: space-between;
align-items: center;
}

.user-item:last-child {
border-bottom: none;
}

.user-info {
flex: 1;
}

.user-name {
font-weight: bold;
}

.user-code {
font-size: 0.8rem;
color: #666;
margin-top: 0.2rem;
}

.user-status {
display: inline-block;
padding: 0.2rem 0.5rem;
border-radius: 12px;
font-size: 0.7rem;
font-weight: bold;
margin-right: 10px;
}

.status-active {
background: #4caf50;
color: white;
}

.status-inactive {
background: #f44336;
color: white;
}

.user-controls {
display: flex;
gap: 5px;
}

.user-btn {
padding: 0.3rem 0.8rem;
font-size: 0.7rem;
}

.user-btn.toggle {
background: #9c27b0;
}

.user-btn.delete {
background: #f44336;
}

.user-btn.export {
background: #2196f3;
}

.user-btn.delete-results {
background: #ff9800;
}

.user-results {
margin-top: 1rem;
}

.user-result-item {
background: white;
padding: 1rem;
margin: 0.5rem 0;
border-radius: 5px;
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.user-result-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 0.5rem;
}

.user-result-stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 0.5rem;
margin-top: 0.5rem;
}

.user-stat {
text-align: center;
padding: 0.5rem;
background: #f5f5f5;
border-radius: 4px;
}

.user-stat-number {
font-weight: bold;
font-size: 1.2rem;
}

.user-stat-label {
font-size: 0.7rem;
color: #666;
}

.password-change {
background: #e3f2fd;
border-left: 4px solid #2196f3;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.password-change h3 {
color: #1565c0;
}

.quiz-model {
background: #f3e5f5;
border-left: 4px solid #9c27b0;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.quiz-model h3 {
color: #7b1fa2;
}

.model-badge {
display: inline-block;
padding: 0.3rem 0.8rem;
background: #9c27b0;
color: white;
border-radius: 15px;
font-size: 0.8rem;
font-weight: bold;
margin-right: 10px;
cursor: pointer;
transition: all 0.3s ease;
}

.model-badge:hover {
background: #7b1fa2;
transform: scale(1.05);
}

.model-item {
padding: 0.8rem;
border-bottom: 1px solid #eee;
display: flex;
justify-content: space-between;
align-items: center;
cursor: pointer;
transition: all 0.3s ease;
}

.model-item:hover {
background: #f3e5f5;
}

.model-item:last-child {
border-bottom: none;
}

.model-info {
flex: 1;
}

.model-name {
font-weight: bold;
font-size: 1.1rem;
}

.model-count {
font-size: 0.8rem;
color: #666;
margin-top: 0.2rem;
}

.model-controls {
display: flex;
gap: 5px;
}

.model-btn {
padding: 0.3rem 0.8rem;
font-size: 0.7rem;
}

.model-btn.delete {
background: #f44336;
}

.model-btn.select {
background: #4caf50;
}

.model-btn.selected {
background: #2e7d32;
}

.model-btn.deselect {
background: #ff9800;
}

.active-model-display {
background: #e8f5e9;
border-left: 4px solid #4caf50;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.active-model-display h3 {
color: #2e7d32;
margin-bottom: 0.5rem;
}

.quick-nav {
display: flex;
gap: 10px;
margin: 1rem 0;
flex-wrap: wrap;
}

.quick-nav-btn {
background: #1a3a5f;
padding: 0.5rem 1rem;
font-size: 0.8rem;
}

.quick-nav-btn:hover {
background: #2c5c8a;
}

.modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.5);
}

.modal-content {
background-color: white;
margin: 10% auto;
padding: 2rem;
border-radius: 10px;
width: 90%;
max-width: 500px;
box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1rem;
}

.close-modal {
background: none;
border: none;
font-size: 1.5rem;
cursor: pointer;
color: #666;
}

.close-modal:hover {
color: #333;
}

.model-selection-list {
max-height: 300px;
overflow-y: auto;
margin: 1rem 0;
}

.model-selection-item {
padding: 1rem;
border: 1px solid #ddd;
border-radius: 5px;
margin-bottom: 0.5rem;
cursor: pointer;
transition: all 0.3s ease;
}

.model-selection-item:hover {
background: #f5f5f5;
border-color: #1a3a5f;
}

.model-selection-item.selected {
background: #e8f5e9;
border-color: #4caf50;
}

.quiz-separator {
border-top: 2px dashed #ddd;
margin: 2rem 0;
padding-top: 1rem;
}

.quiz-title {
font-size: 1.2rem;
font-weight: bold;
color: #1a3a5f;
margin-bottom: 1rem;
padding: 0.5rem;
background: #f8f9fa;
border-radius: 5px;
}

.rank-display {
position: fixed;
top: 100px;
right: 20px;
background: rgba(255,255,255,0.95);
padding: 15px;
border-radius: 10px;
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
border-left: 4px solid #1a3a5f;
z-index: 1000;
min-width: 200px;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
transition: all 0.3s ease;
}

.rank-display.celebrate {
animation: pulse 1s infinite;
border-left-color: #ffd700 !important;
}

@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}

.final-rank-section {
background: linear-gradient(135deg, #1a3a5f 0%, #2c5c8a 100%);
color: white;
padding: 25px;
border-radius: 15px;
margin: 20px 0;
text-align: center;
box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.question-modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.5);
overflow: auto;
}

.question-modal-content {
background-color: white;
margin: 5% auto;
padding: 2rem;
border-radius: 10px;
width: 90%;
max-width: 800px;
box-shadow: 0 5px 15px rgba(0,0,0,0.3);
max-height: 80vh;
overflow-y: auto;
}

.question-modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1.5rem;
border-bottom: 1px solid #eee;
padding-bottom: 1rem;
}

.question-modal-title {
font-size: 1.5rem;
color: #1a3a5f;
}

.question-modal-body {
line-height: 1.6;
}

.question-modal-answers {
margin-top: 1.5rem;
}

.answer-item {
padding: 0.8rem;
margin: 0.5rem 0;
border-radius: 5px;
background: #f8f9fa;
border-left: 4px solid #ddd;
}

.answer-item.correct {
background: #e8f5e9;
border-left-color: #4caf50;
}

.answer-item.incorrect {
background: #ffebee;
border-left-color: #f44336;
}

.host-dashboard {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 1.5rem;
margin-bottom: 2rem;
}

.dashboard-card {
background: white;
border-radius: 10px;
padding: 1.5rem;
box-shadow: 0 5px 15px rgba(0,0,0,0.08);
border-left: 4px solid #1a3a5f;
}

.dashboard-card h3 {
margin-top: 0;
color: #1a3a5f;
}

.dashboard-stat {
font-size: 2rem;
font-weight: bold;
margin: 1rem 0;
color: #1a3a5f;
}

.dashboard-label {
font-size: 0.9rem;
color: #666;
}

.dashboard-actions {
margin-top: 1rem;
display: flex;
gap: 10px;
flex-wrap: wrap;
}

.news-events-section {
background: #f8f9fa;
border-left: 4px solid #1a3a5f;
padding: 1.5rem;
margin: 1.5rem 0;
border-radius: 8px;
}

.news-events-tabs {
display: flex;
border-bottom: 2px solid #ddd;
margin-bottom: 1rem;
}

.news-events-tab {
padding: 0.8rem 1.5rem;
cursor: pointer;
font-weight: 600;
transition: all 0.3s ease;
border-bottom: 3px solid transparent;
}

.news-events-tab.active {
border-bottom-color: #1a3a5f;
color: #1a3a5f;
}

.news-events-content {
display: none;
}

.news-events-content.active {
display: block;
}

.news-item, .event-item {
background: white;
padding: 1rem;
margin: 1rem 0;
border-radius: 8px;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
border-right: 4px solid #1a3a5f;
}

.news-title, .event-title {
font-size: 1.2rem;
font-weight: bold;
color: #1a3a5f;
margin-bottom: 0.5rem;
}

.news-date, .event-date {
font-size: 0.9rem;
color: #666;
margin-bottom: 0.5rem;
}

.news-content, .event-description {
line-height: 1.6;
}

.event-details {
margin-top: 0.5rem;
font-size: 0.9rem;
color: #555;
}

.event-location, .event-time {
display: flex;
align-items: center;
gap: 5px;
margin: 0.3rem 0;
}

.add-news-event {
margin-top: 1.5rem;
padding: 1rem;
background: #e3f2fd;
border-radius: 8px;
}

.add-news-event h4 {
color: #1565c0;
margin-bottom: 1rem;
}

.form-row {
display: flex;
gap: 1rem;
margin-bottom: 1rem;
flex-wrap: wrap;
}

.form-row input, .form-row textarea, .form-row select {
flex: 1;
min-width: 200px;
}

@media (max-width: 768px) {
.container {
width: 100%;
margin: 10px;
padding: 0;
}

header {
padding: 1rem;
}

h1 {
font-size: 1.6rem;
}

.tabs {
flex-direction: row;
overflow-x: auto;
}

.tab {
padding: 0.8rem;
min-width: 100px;
font-size: 0.8rem;
}

.content {
padding: 1rem;
}

.admin-controls {
flex-direction: column;
}

.answer-option {
flex-direction: column;
align-items: flex-start;
}

.answer-option input[type="text"] {
width: 100%;
margin-left: 0;
margin-bottom: 5px;
}

.time-input-group {
flex-direction: column;
align-items: flex-start;
}

.time-input-group input, .time-input-group select {
max-width: 100%;
}

.result-header, .result-row {
grid-template-columns: 1fr;
font-size: 0.8rem;
min-width: auto;
}

.stats-grid {
grid-template-columns: 1fr;
}

.export-buttons {
flex-direction: column;
}

.result-stats {
grid-template-columns: 1fr;
}

.user-item {
flex-direction: column;
align-items: flex-start;
}

.user-controls {
margin-top: 0.5rem;
width: 100%;
justify-content: flex-end;
}

.model-item {
flex-direction: column;
align-items: flex-start;
}

.model-controls {
margin-top: 0.5rem;
width: 100%;
justify-content: flex-end;
}

.quick-nav {
flex-direction: column;
}

.modal-content {
margin: 5% auto;
width: 95%;
padding: 1rem;
}

.question-modal-content {
margin: 10% auto;
width: 95%;
padding: 1rem;
}

.rank-display {
position: relative;
top: auto;
right: auto;
margin: 1rem 0;
width: 100%;
}

.host-dashboard {
grid-template-columns: 1fr;
}

.form-row {
flex-direction: column;
}

.form-row input, .form-row textarea, .form-row select {
min-width: 100%;
}
}

@media (min-width: 1200px) {
.container {
max-width: 1400px;
}

.content {
padding: 2rem;
}
}

@media (max-width: 480px) {
body {
padding: 10px;
}

.container {
border-radius: 8px;
}

.card {
padding: 1rem;
margin: 1rem 0;
}

h2 {
font-size: 1.3rem;
}

h3 {
font-size: 1.1rem;
}
}
</style>
</head>
<body>
<div class="container">
<header>
<div class="header-content">
<div class="quiz-timer" id="quiz-timer">
â±ï¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯
</div>
<div class="header-title">
<h1>Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©</h1>
<p class="subtitle">Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯</p>
</div>
<div class="player-count" id="player-count">
ğŸ‘¤ <span id="current-player-count">0</span> Ù„Ø§Ø¹Ø¨ÙŠÙ†
</div>
</div>
</header>

<div class="tabs">
<div class="tab active" onclick="switchTab('player')">Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</div>
<div class="tab" onclick="switchTab('host')">Ø§Ù„Ù…Ø´Ø±Ù</div>
<div class="tab" onclick="switchTab('news-events')">Ø§Ù„Ù†Ø´Ø±Ø© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
<div class="tab" onclick="switchTab('about')">Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
</div>

<div class="content">
<!-- Player Tab -->
<div id="player" class="tab-content active">
<h2>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
<div class="time-info" id="quiz-time-info">
<p>Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¬Ø¯ÙˆÙ„ Ù„Ù€ <strong id="quiz-time-range">ØºØ¯Ø§Ù‹ Ù…Ù† 12:00 Ø¸Ù‡Ø±Ø§Ù‹ Ø¥Ù„Ù‰ 12:30 Ø¸Ù‡Ø±Ø§Ù‹</strong></p>
<p id="quiz-status">Ø§Ù„Ø­Ø§Ù„Ø©: <span id="quiz-status-text">Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯</span></p>
</div>

<div class="card">
<input id="player-code" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
<button id="joinBtn">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>

<div id="player-question"></div>
<div id="countdown" class="countdown"></div>
<div id="player-answers"></div>
</div>

<div class="instructions">
<h3>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</h3>
<ol>
<li>Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙˆØ§Ø¶ØºØ· "Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±"</li>
<li>Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
<li>Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¹Ù†Ø¯Ù…Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</li>
<li>Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ ÙˆÙˆÙ‚Øª Ø§Ø³ØªØ¬Ø§Ø¨ØªÙƒ</li>
<li>ÙƒÙ„ Ø¬Ù‡Ø§Ø² Ù„Ù‡ Ø¬Ù„Ø³Ø© Ù…Ù†ÙØµÙ„Ø© - Ù„Ù† ØªØªØ¹Ø§Ø±Ø¶ Ø§Ù„Ø±Ù…ÙˆØ²</li>
<li>Ø§Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬Ùƒ ÙˆÙ‚Ù… Ø¨ØªÙ†Ø²ÙŠÙ„Ù‡Ø§ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</li>
<li><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„ÙƒÙ„ Ø¬Ù„Ø³Ø©</li>
</ol>
</div>
</div>

<!-- Host Tab -->
<div id="host" class="tab-content">
<h2>Ù…Ø´Ø±Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„)</h2>

<div class="admin-section">
<h3>Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</h3>
<div class="security-notice">
<h4>ğŸ”’ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø£Ù…Ø§Ù†</h4>
<p>Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ùˆ <strong>ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©</strong>. ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† Ù…Ø­Ù„ÙŠØ§Ù‹.</p>
</div>
<div class="form-group">
<label for="admin-code">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</label>
<input type="password" id="admin-code" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„">
<button onclick="verifyAdmin()">Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù</button>
</div>
<div id="admin-status" class="url-status">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù</div>
</div>

<div id="admin-features" style="display: none;">
<!-- Host Dashboard -->
<div class="host-dashboard">
<div class="dashboard-card">
<h3>Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
<div class="dashboard-stat" id="dashboard-quiz-status">Ù„Ù… ÙŠØ¨Ø¯Ø£</div>
<div class="dashboard-label" id="dashboard-quiz-time">Ø§Ù„ÙˆÙ‚Øª: --:-- - --:--</div>
<div class="dashboard-actions">
<button onclick="scrollToSection('time-config')">ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆÙ‚Øª</button>
<button onclick="scrollToSection('quiz-model')">Ø§Ø®ØªØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
</div>
</div>

<div class="dashboard-card">
<h3>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</h3>
<div class="dashboard-stat" id="dashboard-player-count">0</div>
<div class="dashboard-label">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</div>
<div class="dashboard-actions">
<button onclick="scrollToSection('user-management')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
<button onclick="loadQuizResults()">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
</div>
</div>

<div class="dashboard-card">
<h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
<div class="dashboard-stat" id="dashboard-question-count">0</div>
<div class="dashboard-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
<div class="dashboard-actions">
<button onclick="scrollToSection('question-management')">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø©</button>
<button onclick="viewAllQuestions()">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
</div>
</div>

<div class="dashboard-card">
<h3>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·</h3>
<div class="dashboard-stat" id="dashboard-active-model">Ù„Ø§ ÙŠÙˆØ¬Ø¯</div>
<div class="dashboard-label">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯</div>
<div class="dashboard-actions">
<button onclick="scrollToSection('quiz-model')">ØªØºÙŠÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
<button onclick="clearActiveModel()">Ù…Ø³Ø­</button>
</div>
</div>
</div>

<!-- Quick Navigation -->
<div class="quick-nav">
<button class="quick-nav-btn" onclick="scrollToSection('active-model')">Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·</button>
<button class="quick-nav-btn" onclick="scrollToSection('password-change')">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
<button class="quick-nav-btn" onclick="scrollToSection('time-config')">ÙˆÙ‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
<button class="quick-nav-btn" onclick="scrollToSection('quiz-model')">Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</button>
<button class="quick-nav-btn" onclick="scrollToSection('user-management')">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
<button class="quick-nav-btn" onclick="scrollToSection('question-management')">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
<button class="quick-nav-btn" onclick="scrollToSection('quiz-results')">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
</div>

<!-- Active Model Display -->
<div class="active-model-display" id="active-model">
<h3>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø´Ø·</h3>
<p id="active-model-info">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†Ù…ÙˆØ°Ø¬. Ø³ÙŠØ±Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.</p>
<button onclick="clearActiveModel()" class="model-btn deselect">Ù…Ø³Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
</div>

<!-- Password Change Section -->
<div class="password-change" id="password-change">
<h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
<div class="form-group">
<label for="current-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
<input type="password" id="current-password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
</div>
<div class="form-group">
<label for="new-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
<input type="password" id="new-password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
</div>
<div class="form-group">
<label for="confirm-password">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
<input type="password" id="confirm-password" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
</div>
<button onclick="changeAdminPassword()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
<div id="password-status" class="url-status">Ù‚Ù… Ø¨ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù‡Ù†Ø§</div>
</div>

<div class="time-config" id="time-config">
<h3>ØªÙƒÙˆÙŠÙ† ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
<p>Ø­Ø¯Ø¯ Ù…ØªÙ‰ Ø³ÙŠÙƒÙˆÙ† Ø§Ø®ØªØ¨Ø§Ø±Ùƒ Ù†Ø´Ø·Ø§Ù‹</p>

<div class="form-group">
<label for="host-quiz-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
<input type="date" id="host-quiz-date">
</div>

<div class="form-group">
<label for="host-start-time">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡:</label>
<div class="time-input-group">
<input type="number" id="host-start-hour" min="1" max="12" value="12" placeholder="Ø³Ø§Ø¹Ø©">
<input type="number" id="host-start-minute" min="0" max="59" value="0" placeholder="Ø¯Ù‚ÙŠÙ‚Ø©">
<select id="host-start-ampm">
<option value="AM">Øµ</option>
<option value="PM" selected>Ù…</option>
</select>
</div>
</div>

<div class="form-group">
<label for="host-quiz-duration">Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¯Ù‚Ø§Ø¦Ù‚):</label>
<select id="host-quiz-duration">
<option value="15">15 Ø¯Ù‚ÙŠÙ‚Ø©</option>
<option value="30" selected>30 Ø¯Ù‚ÙŠÙ‚Ø©</option>
<option value="45">45 Ø¯Ù‚ÙŠÙ‚Ø©</option>
<option value="60">1 Ø³Ø§Ø¹Ø©</option>
<option value="90">1.5 Ø³Ø§Ø¹Ø©</option>
<option value="120">2 Ø³Ø§Ø¹Ø©</option>
</select>
</div>

<button onclick="saveHostQuizTime()">Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
<div id="host-time-status" class="url-status">Ø§Ø¶Ø¨Ø· Ù…ØªÙ‰ Ø³ÙŠÙƒÙˆÙ† Ø§Ø®ØªØ¨Ø§Ø±Ùƒ Ù†Ø´Ø·Ø§Ù‹</div>
</div>

<!-- Quiz Models Section -->
<div class="quiz-model" id="quiz-model">
<h3>Ø¥Ø¯Ø§Ø±Ø© Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>

<div class="form-group">
<label for="model-name">Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:</label>
<input type="text" id="model-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬">
</div>

<button onclick="addQuizModel()">Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯</button>
<div id="model-status" class="url-status">Ø£Ù†Ø´Ø¦ Ù†Ù…Ø§Ø°Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>

<div class="question-list">
<h4>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ© - Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h4>
<div id="models-container"></div>
</div>

<!-- Model Recovery Tools -->
<div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-radius: 5px;">
<h4>ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</h4>
<p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø¥Ø°Ø§ ÙÙ‚Ø¯Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ø±ØªØ¨Ø§Ø·Ù‡Ø§ Ø¨Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:</p>
<button onclick="recoverMissingModels()" class="model-btn" style="background: #ff9800;">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©</button>
<button onclick="validateAllModels()" class="model-btn" style="background: #2196f3;">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</button>
<button onclick="debugModelQuestions()" class="model-btn" style="background: #607d8b;">ØªØµØ­ÙŠØ­ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
</div>
</div>

<!-- User Management Section -->
<div class="user-management" id="user-management">
<h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>

<div class="form-group">
<label for="user-name">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
<input type="text" id="user-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…">
</div>

<div class="form-group">
<label for="user-code">Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„:</label>
<input type="text" id="user-code" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø¯Ø®ÙˆÙ„ ÙØ±ÙŠØ¯">
</div>

<button onclick="addUser()">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
<div id="user-status" class="url-status">Ø£Ø¶Ù Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø±Ù…ÙˆØ² Ø¯Ø®ÙˆÙ„ ÙØ±ÙŠØ¯Ø©</div>

<div class="user-list">
<h4>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</h4>
<div id="users-container"></div>
</div>
</div>

<div class="admin-section" id="question-management">
<h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>

<div class="form-group">
<label for="question-model">Ø§Ø®ØªØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:</label>
<select id="question-model">
<option value="">-- Ø§Ø®ØªØ± Ù†Ù…ÙˆØ°Ø¬Ù‹Ø§ --</option>
</select>
</div>

<div class="form-group">
<label for="question-text">Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
<textarea id="question-text" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¤Ø§Ù„Ùƒ"></textarea>
</div>

<div class="form-group">
<label>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</label>
<div class="answer-option">
<input type="text" id="answer-1" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 1">
<input type="radio" name="correct-answer" value="0" checked> Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
</div>
<div class="answer-option">
<input type="text" id="answer-2" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 2">
<input type="radio" name="correct-answer" value="1"> Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
</div>
<div class="answer-option">
<input type="text" id="answer-3" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 3">
<input type="radio" name="correct-answer" value="2"> Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
</div>
<div class="answer-option">
<input type="text" id="answer-4" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 4">
<input type="radio" name="correct-answer" value="3"> Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
</div>
</div>

<button onclick="addQuestion()">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
<div id="question-status" class="url-status">Ø£Ø¶Ù Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
</div>

<div class="question-list">
<h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© <span id="current-model-display"></span></h3>
<button class="admin-btn" onclick="viewAllQuestions()" style="margin-bottom: 10px;">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
<div id="questions-container"></div>
</div>

<div class="admin-section" id="quiz-results">
<h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
<div class="export-buttons">
<button class="export-btn" onclick="exportToExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
<button class="export-btn csv" onclick="exportToCSV()">ğŸ“„ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV</button>
<button class="export-btn csv" onclick="downloadAllUserResults()">ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ±Ø¯ÙŠØ© (Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙ‚Ø·)</button>
<button class="export-btn delete" onclick="confirmDeleteResults()">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
<button onclick="loadQuizResults()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
</div>
<div id="results-container" class="question-list">Ø§Ù†Ù‚Ø± "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªØ§Ø¦Ø¬" Ù„ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>

<!-- Individual User Results -->
<div class="user-results">
<h3>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ±Ø¯ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
<div id="user-results-container"></div>
</div>
</div>
</div>

<div class="instructions">
<h3>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù</h3>
<ol>
<li>Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù</li>
<li>Ø£Ù†Ø´Ø¦ Ù†Ù…Ø§Ø°Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</li>
<li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù„Ø¹Ø±Ø¶ Ø£Ø³Ø¦Ù„ØªÙ‡Ø§</li>
<li>Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "ØªØ­Ø¯ÙŠØ¯" Ù„ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ ÙƒÙ†Ø´Ø· Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
<li>Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯" Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ø§Ù„Ù†Ø´Ø·</li>
<li>Ø£Ø¶Ù Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø±Ù…ÙˆØ² Ø¯Ø®ÙˆÙ„ ÙØ±ÙŠØ¯Ø©</li>
<li>Ø­Ø¯Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ù„Ø§Ø®ØªØ¨Ø§Ø±Ùƒ</li>
<li>Ø£Ø¶Ù Ø£Ø³Ø¦Ù„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</li>
<li>Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø²Ø±Ø§Ø± Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©</li>
<li>Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ù‚Ø³Ù… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
<li>Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Excel Ø£Ùˆ CSV Ù„Ù„ØªØ­Ù„ÙŠÙ„</li>
<li>ÙŠØ¯Ø¹Ù… 30+ Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ²Ø§Ù…Ù† Ø¨Ø³Ù‡ÙˆÙ„Ø©</li>
<li>ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ«</li>
</ol>
</div>
</div>

<!-- News and Events Tab -->
<div id="news-events" class="tab-content">
<h2>Ø§Ù„Ù†Ø´Ø±Ø© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>

<div class="news-events-section">
<div class="news-events-tabs">
<div class="news-events-tab active" onclick="switchNewsEventsTab('news')">Ø§Ù„Ù†Ø´Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
<div class="news-events-tab" onclick="switchNewsEventsTab('events')">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</div>
<div class="news-events-tab" onclick="switchNewsEventsTab('add')">Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯</div>
</div>

<!-- News Content -->
<div id="news-content" class="news-events-content active">
<h3>Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</h3>
<div id="news-container">
<!-- News items will be populated here -->
</div>
</div>

<!-- Events Content -->
<div id="events-content" class="news-events-content">
<h3>Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
<div id="events-container">
<!-- Event items will be populated here -->
</div>
</div>

<!-- Add News/Event Content -->
<div id="add-content" class="news-events-content">
<div class="add-news-event">
<h4>Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ ÙØ¹Ø§Ù„ÙŠØ©</h4>
<div class="form-group">
<label for="item-type">Ø§Ù„Ù†ÙˆØ¹:</label>
<select id="item-type">
<option value="news">Ø®Ø¨Ø±</option>
<option value="event">ÙØ¹Ø§Ù„ÙŠØ©</option>
</select>
</div>
<div class="form-group">
<label for="item-title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
<input type="text" id="item-title" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
</div>
<div class="form-group">
<label for="item-content">Ø§Ù„Ù…Ø­ØªÙˆÙ‰/Ø§Ù„ÙˆØµÙ:</label>
<textarea id="item-content" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø§Ù„ÙˆØµÙ"></textarea>
</div>
<div class="form-row">
<div class="form-group">
<label for="item-date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
<input type="date" id="item-date">
</div>
<div class="form-group" id="event-time-group" style="display: none;">
<label for="event-time">Ø§Ù„ÙˆÙ‚Øª:</label>
<input type="time" id="event-time">
</div>
</div>
<div class="form-group" id="event-location-group" style="display: none;">
<label for="event-location">Ø§Ù„Ù…ÙƒØ§Ù†:</label>
<input type="text" id="event-location" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙƒØ§Ù† Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©">
</div>
<button onclick="addNewsEvent()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="news-event-status" class="url-status">Ø£Ø¶Ù Ø®Ø¨Ø±Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ø£Ùˆ ÙØ¹Ø§Ù„ÙŠØ© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
</div>
</div>
</div>
</div>

<!-- About Tab -->
<div id="about" class="tab-content">
<h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©</h2>

<div class="setup-complete">
<h3>âœ… Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©! âœ…</h3>
<p>ØªÙ… ØªØ­Ø³ÙŠÙ† ØªØ·Ø¨ÙŠÙ‚ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¡ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠ Ù…Ø¹ Firebase.</p>
<p><strong>Ø§Ù„Ø³Ø¹Ø©:</strong> 30+ Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ²Ø§Ù…Ù† | <strong>Ø§Ù„ØªØ®Ø²ÙŠÙ†:</strong> Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</p>
<button onclick="switchTab('player')">Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</button>
</div>

<div class="admin-section">
<h3>Ø³Ø¹Ø© Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©</h3>
<div class="stats-grid">
<div class="stat-card">
<span class="stat-number">100</span>
<span class="stat-label">Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†ÙŠÙ†</span>
</div>
<div class="stat-card">
<span class="stat-number">1GB</span>
<span class="stat-label">Ø­Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ</span>
</div>
<div class="stat-card">
<span class="stat-number">âˆ</span>
<span class="stat-label">Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span>
</div>
<div class="stat-card">
<span class="stat-number">$0</span>
<span class="stat-label">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span>
</div>
</div>
</div>

<div class="instructions">
<h3>Ù…Ù…ÙŠØ²Ø§Øª Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©</h3>
<ol>
<li><strong>Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ:</strong> ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
<li><strong>Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙØ±Ø© ÙÙŠ Firebase</li>
<li><strong>Ø§Ù„ØªØµÙ†ÙŠÙ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ:</strong> Ø´Ø§Ù‡Ø¯ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø­ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
<li><strong>ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰:</strong> Ù‚Ù… Ø¨ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙ‚Ø· Ø¨Ø´ÙƒÙ„ Ø¬Ù…Ø§Ø¹ÙŠ</li>
<li><strong>Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„ÙØ±Ø¯ÙŠ:</strong> Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø­Ø¯Ø¯ÙŠÙ†</li>
</ol>
</div>

<div class="card">
<h3>Ù…Ù…ÙŠØ²Ø§Øª Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©</h3>
<ul>
<li>âœ… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù…Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</li>
<li>âœ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</li>
<li>âœ… Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©</li>
<li>âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­/Ø§Ù„Ø±Ø³ÙˆØ¨ (Ø­Ø¯ 50%)</li>
<li>âœ… Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙ†ÙŠÙ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</li>
</ul>
</div>
</div>
</div>
</div>

<!-- Model Selection Modal -->
<div id="modelSelectionModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3>Ø§Ø®ØªØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±</h3>
<button class="close-modal" onclick="closeModelSelection()">&times;</button>
</div>
<div class="model-selection-list" id="modelSelectionList">
<!-- Models will be populated here -->
</div>
<div class="modal-footer">
<button onclick="exportSelectedModel()" style="background: #4caf50; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;">ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
<button onclick="closeModelSelection()" style="background: #f44336; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; margin-right: 10px;">Ø¥Ù„ØºØ§Ø¡</button>
</div>
</div>
</div>

<!-- Question View Modal -->
<div id="questionViewModal" class="question-modal">
<div class="question-modal-content">
<div class="question-modal-header">
<h3 class="question-modal-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„</h3>
<button class="close-modal" onclick="closeQuestionView()">&times;</button>
</div>
<div class="question-modal-body" id="question-modal-body">
<!-- Question details will be populated here -->
</div>
</div>
</div>

<script>
// Firebase configuration
const firebaseConfig = {
apiKey: "AIzaSyDnt-BAUsCbQMZ-PPALhp3_tsYqcHAKEZ8",
authDomain: "thequizfs.firebaseapp.com",
databaseURL: "https://thequizfs-default-rtdb.firebaseio.com",
projectId: "thequizfs",
storageBucket: "thequizfs.firebasestorage.app",
messagingSenderId: "16144411406",
appId: "1:16144411406:web:d83affb2013dea665e055f",
measurementId: "G-NXX4GQZ4NF"
};

// Initialize Firebase with error handling
let app;
try {
app = firebase.initializeApp(firebaseConfig);
} catch (error) {
if (error.code === 'app/duplicate-app') {
app = firebase.app();
} else {
console.error('Firebase initialization error:', error);
}
}
const database = firebase.database();

// Store admin password in Firebase to persist across sessions
let adminCode = "adminCourt"; // Default password

// Load admin password from Firebase on startup
function loadAdminPassword() {
database.ref('adminPassword').once('value')
.then((snapshot) => {
const savedPassword = snapshot.val();
if (savedPassword) {
adminCode = savedPassword;
console.log("Admin password loaded from Firebase");
}
})
.catch((error) => {
console.error("Error loading admin password:", error);
});
}

// Save admin password to Firebase
function saveAdminPassword(newPassword) {
database.ref('adminPassword').set(newPassword)
.then(() => {
console.log("Admin password saved to Firebase");
})
.catch((error) => {
console.error("Error saving admin password:", error);
});
}

// Session management - unique for each device with fallback for incognito mode
function getSessionId() {
// Try sessionStorage first (normal browser)
if (sessionStorage.getItem('playerSessionId')) {
return sessionStorage.getItem('playerSessionId');
}

// Try localStorage as fallback (incognito mode)
if (localStorage.getItem('playerSessionId')) {
return localStorage.getItem('playerSessionId');
}

// Create new session ID
const sessionId = 'session-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

// Try to save in sessionStorage first
try {
sessionStorage.setItem('playerSessionId', sessionId);
} catch (e) {
// If sessionStorage fails (incognito), use localStorage
localStorage.setItem('playerSessionId', sessionId);
}

return sessionId;
}

// Tab switching functionality
function switchTab(tabName) {
document.querySelectorAll('.tab-content').forEach(tab => {
tab.classList.remove('active');
});
document.getElementById(tabName).classList.add('active');

document.querySelectorAll('.tab').forEach(tab => {
tab.classList.remove('active');
});

event.target.classList.add('active');

if (tabName === 'host') {
loadHostTimeSettings();
loadUsers();
loadQuizModels();
updateActiveModelDisplay();
updateDashboard();
} else if (tabName === 'news-events') {
loadNewsAndEvents();
}
}

// Switch between news and events tabs
function switchNewsEventsTab(tabName) {
document.querySelectorAll('.news-events-content').forEach(tab => {
tab.classList.remove('active');
});
document.getElementById(tabName + '-content').classList.add('active');

document.querySelectorAll('.news-events-tab').forEach(tab => {
tab.classList.remove('active');
});

event.target.classList.add('active');

// Show/hide form fields based on selection
if (tabName === 'add') {
document.getElementById('item-type').addEventListener('change', function() {
const isEvent = this.value === 'event';
document.getElementById('event-time-group').style.display = isEvent ? 'block' : 'none';
document.getElementById('event-location-group').style.display = isEvent ? 'block' : 'none';
});
}
}

// Quick navigation function
function scrollToSection(sectionId) {
document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
}

// Initialize variables
var questions = [];
var users = [];
var quizModels = [];
var currentIndex = 0;
var playerCode = "";
var countdownInterval;
var timeLeft = 25;
var questionStartTime;
var quizActive = false;
var currentModelFilter = null;
var activeQuizModel = null;
var selectedUserForExport = null;
var selectedModelForExport = null;

// Player results tracking
var playerResults = {
correct: 0,
incorrect: 0,
total: 0,
responseTimes: [],
accuracy: 0
};

// Real-time ranking system
let playerRankings = {};
let rankingUpdateInterval = null;

// Quiz timing configuration
var quizStartTime = localStorage.getItem('quizStartTime');
var quizEndTime = localStorage.getItem('quizEndTime');

if (!quizStartTime) {
var tomorrow = new Date();
tomorrow.setDate(tomorrow.getDate() + 1);
tomorrow.setHours(12, 0, 0, 0);
quizStartTime = tomorrow.getTime();
localStorage.setItem('quizStartTime', quizStartTime);
} else {
quizStartTime = parseInt(quizStartTime);
}

if (!quizEndTime) {
var endTime = new Date(quizStartTime);
endTime.setMinutes(endTime.getMinutes() + 30);
quizEndTime = endTime.getTime();
localStorage.setItem('quizEndTime', quizEndTime);
} else {
quizEndTime = parseInt(quizEndTime);
}

// News and Events data
var newsItems = [];
var events = [];

// Load data from Firebase
function loadDataFromFirebase() {
if (!firebase.apps.length) {
setTimeout(loadDataFromFirebase, 1000);
return;
}

// Load admin password first
loadAdminPassword();

database.ref('quizTime').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
quizStartTime = data.startTime;
quizEndTime = data.endTime;
localStorage.setItem('quizStartTime', quizStartTime);
localStorage.setItem('quizEndTime', quizEndTime);
updateQuizTimeInfo();
updateDashboard();
}
});

database.ref('questions').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
questions = Object.values(data);
} else {
questions = [];
}

localStorage.setItem('quizQuestions', JSON.stringify(questions));
displayQuestions();
updateDashboard();

if (document.getElementById('player').classList.contains('active') &&
document.getElementById('player-question').innerHTML !== "") {
showPlayerQuestion();
}
});

// Load users
database.ref('users').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
users = Object.values(data);
} else {
users = [];
}

localStorage.setItem('quizUsers', JSON.stringify(users));
if (document.getElementById('host').classList.contains('active')) {
displayUsers();
updateDashboard();
}
});

// Load quiz models
database.ref('quizModels').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
quizModels = Object.values(data);
} else {
quizModels = [];
}

localStorage.setItem('quizModels', JSON.stringify(quizModels));
if (document.getElementById('host').classList.contains('active')) {
displayQuizModels();
updateDashboard();
}
});

// Load active quiz model
database.ref('activeQuizModel').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
activeQuizModel = data;
updateActiveModelDisplay();
updateDashboard();
} else {
activeQuizModel = null;
updateActiveModelDisplay();
updateDashboard();
}
});

// Load news and events
database.ref('news').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
newsItems = Object.values(data);
} else {
newsItems = [];
}
if (document.getElementById('news-events').classList.contains('active')) {
displayNews();
}
});

database.ref('events').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
events = Object.values(data);
} else {
events = [];
}
if (document.getElementById('news-events').classList.contains('active')) {
displayEvents();
}
});

// Track active players
database.ref('activePlayers').on('value', (snapshot) => {
const data = snapshot.val();
if (data) {
const activePlayerCount = Object.keys(data).length;
document.getElementById('current-player-count').textContent = activePlayerCount;
document.getElementById('dashboard-player-count').textContent = activePlayerCount;

// Add visual feedback when players are active
const playerCountElement = document.getElementById('player-count');
if (activePlayerCount > 0) {
playerCountElement.classList.add('active');
} else {
playerCountElement.classList.remove('active');
}
} else {
document.getElementById('current-player-count').textContent = '0';
document.getElementById('dashboard-player-count').textContent = '0';
document.getElementById('player-count').classList.remove('active');
}
});
}

// Load news and events from Firebase
function loadNewsAndEvents() {
database.ref('news').once('value')
.then((snapshot) => {
const data = snapshot.val();
if (data) {
newsItems = Object.values(data);
} else {
newsItems = [];
}
displayNews();
});

database.ref('events').once('value')
.then((snapshot) => {
const data = snapshot.val();
if (data) {
events = Object.values(data);
} else {
events = [];
}
displayEvents();
});
}

// Display news items
function displayNews() {
const container = document.getElementById('news-container');
container.innerHTML = '';

if (newsItems.length === 0) {
container.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø¨Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
return;
}

// Sort news by date (newest first)
newsItems.sort((a, b) => new Date(b.date) - new Date(a.date));

newsItems.forEach(news => {
const newsDate = new Date(news.date).toLocaleDateString('ar-EG');
const newsItem = document.createElement('div');
newsItem.className = 'news-item';
newsItem.innerHTML = `
<div class="news-title">${news.title}</div>
<div class="news-date">${newsDate}</div>
<div class="news-content">${news.content}</div>
`;
container.appendChild(newsItem);
});
}

// Display events
function displayEvents() {
const container = document.getElementById('events-container');
container.innerHTML = '';

if (events.length === 0) {
container.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
return;
}

// Sort events by date (upcoming first)
events.sort((a, b) => new Date(a.date) - new Date(b.date));

events.forEach(event => {
const eventDate = new Date(event.date).toLocaleDateString('ar-EG');
const eventTime = event.time || '';
const eventItem = document.createElement('div');
eventItem.className = 'event-item';
eventItem.innerHTML = `
<div class="event-title">${event.title}</div>
<div class="event-date">${eventDate}</div>
<div class="event-description">${event.description}</div>
<div class="event-details">
${event.location ? `<div class="event-location">ğŸ“ ${event.location}</div>` : ''}
${event.time ? `<div class="event-time">â° ${event.time}</div>` : ''}
</div>
`;
container.appendChild(eventItem);
});
}

// Add new news or event
function addNewsEvent() {
const type = document.getElementById('item-type').value;
const title = document.getElementById('item-title').value;
const content = document.getElementById('item-content').value;
const date = document.getElementById('item-date').value;
const time = document.getElementById('event-time').value;
const location = document.getElementById('event-location').value;

if (!title || !content || !date) {
document.getElementById('news-event-status').textContent = 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©';
document.getElementById('news-event-status').className = 'url-status error';
return;
}

const newItem = {
id: 'item-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
title: title,
date: date,
timestamp: new Date().toISOString()
};

if (type === 'news') {
newItem.content = content;
database.ref('news/' + newItem.id).set(newItem)
.then(() => {
document.getElementById('news-event-status').textContent = 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¨Ø± Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('news-event-status').className = 'url-status success';
clearNewsEventForm();
})
.catch((error) => {
document.getElementById('news-event-status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¨Ø±: ' + error.message;
document.getElementById('news-event-status').className = 'url-status error';
});
} else {
newItem.description = content;
if (time) newItem.time = time;
if (location) newItem.location = location;
database.ref('events/' + newItem.id).set(newItem)
.then(() => {
document.getElementById('news-event-status').textContent = 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('news-event-status').className = 'url-status success';
clearNewsEventForm();
})
.catch((error) => {
document.getElementById('news-event-status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©: ' + error.message;
document.getElementById('news-event-status').className = 'url-status error';
});
}
}

// Clear news/event form
function clearNewsEventForm() {
document.getElementById('item-title').value = '';
document.getElementById('item-content').value = '';
document.getElementById('item-date').value = '';
document.getElementById('event-time').value = '';
document.getElementById('event-location').value = '';
}

// Update dashboard with current stats
function updateDashboard() {
// Update quiz status
const now = new Date().getTime();
let quizStatus = 'Ù„Ù… ÙŠØ¨Ø¯Ø£';
if (now >= quizStartTime && now <= quizEndTime) {
quizStatus = 'Ù†Ø´Ø·';
} else if (now > quizEndTime) {
quizStatus = 'Ø§Ù†ØªÙ‡Ù‰';
}
document.getElementById('dashboard-quiz-status').textContent = quizStatus;

// Update quiz time
const start = new Date(quizStartTime);
const end = new Date(quizEndTime);
const timeRange = start.toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit'}) +
' - ' + end.toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit'});
document.getElementById('dashboard-quiz-time').textContent = 'Ø§Ù„ÙˆÙ‚Øª: ' + timeRange;

// Update question count
document.getElementById('dashboard-question-count').textContent = questions.length;

// Update active model
if (activeQuizModel) {
const model = quizModels.find(m => m.id === activeQuizModel);
document.getElementById('dashboard-active-model').textContent = model ? model.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
} else {
document.getElementById('dashboard-active-model').textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
}
}

// Save active quiz model to Firebase
function saveActiveQuizModel(modelId) {
database.ref('activeQuizModel').set(modelId)
.then(() => {
console.log("Active quiz model saved to Firebase");
})
.catch((error) => {
console.error("Error saving active quiz model:", error);
});
}

// Clear active quiz model
function clearActiveModel() {
activeQuizModel = null;
saveActiveQuizModel(null);
updateActiveModelDisplay();
displayQuizModels();
updateDashboard();
document.getElementById('model-status').textContent = 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·. Ø³ÙŠØ±Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.';
document.getElementById('model-status').className = 'url-status success';

setTimeout(() => {
document.getElementById('model-status').textContent = 'Ø£Ù†Ø´Ø¦ Ù†Ù…Ø§Ø°Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø©';
document.getElementById('model-status').className = 'url-status';
}, 3000);
}

// Update active model display
function updateActiveModelDisplay() {
const activeModelInfo = document.getElementById('active-model-info');

if (activeQuizModel) {
const model = quizModels.find(m => m.id === activeQuizModel);
const modelName = model ? model.name : 'Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
const questionCount = questions.filter(q => q.modelId === activeQuizModel).length;

activeModelInfo.innerHTML = `
<strong>${modelName}</strong> - ${questionCount} Ø£Ø³Ø¦Ù„Ø©
<br><small>Ø³ÙŠØ±Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙ‚Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</small>
`;
} else {
activeModelInfo.innerHTML = `
<strong>Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†Ù…ÙˆØ°Ø¬</strong>
<br><small>Ø³ÙŠØ±Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</small>
`;
}
}

// Save quiz time to Firebase
function saveQuizTimeToFirebase(startTime, endTime) {
database.ref('quizTime').set({
startTime: startTime,
endTime: endTime
}).then(() => {
document.getElementById('host-time-status').textContent = 'ØªÙ… Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('host-time-status').className = 'url-status success';
updateDashboard();
}).catch((error) => {
document.getElementById('host-time-status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + error.message;
document.getElementById('host-time-status').className = 'url-status error';
});
}

// Save questions to Firebase
function saveQuestionsToFirebase() {
database.ref('questions').set(questions).then(() => {
document.getElementById('question-status').textContent = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('question-status').className = 'url-status success';
updateDashboard();
}).catch((error) => {
document.getElementById('question-status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ' + error.message;
document.getElementById('question-status').className = 'url-status error';
});
}

// Save users to Firebase
function saveUsersToFirebase() {
database.ref('users').set(users).then(() => {
document.getElementById('user-status').textContent = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('user-status').className = 'url-status success';
updateDashboard();
}).catch((error) => {
document.getElementById('user-status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ' + error.message;
document.getElementById('user-status').className = 'url-status error';
});
}

// Save quiz models to Firebase
function saveQuizModelsToFirebase() {
database.ref('quizModels').set(quizModels).then(() => {
document.getElementById('model-status').textContent = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('model-status').className = 'url-status success';
updateDashboard();
}).catch((error) => {
document.getElementById('model-status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬: ' + error.message;
document.getElementById('model-status').className = 'url-status error';
});
}

// Save quiz results to Firebase
function saveToFirebase(playerCode, playerName, question, selectedAnswer, correctAnswer, responseTime, status, modelId) {
const responseId = database.ref().child('quizResults').push().key;

const quizData = {
playerCode: playerCode || "Ø±Ù…Ø² ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
playerName: playerName || "Ù…Ø´Ø§Ø±Ùƒ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
question: question || "Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
selectedAnswer: selectedAnswer || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø©",
correctAnswer: correctAnswer || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
responseTime: responseTime || 0,
status: status || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
timestamp: new Date().toISOString(),
questionIndex: currentIndex,
sessionId: getSessionId(),
deviceType: /Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'Ø¬ÙˆØ§Ù„' : 'ÙƒÙ…Ø¨ÙŠÙˆØªØ±',
modelId: modelId || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬"
};

database.ref('quizResults/' + responseId).set(quizData)
.then(() => {
console.log("Data saved successfully for session:", quizData.sessionId);
})
.catch((error) => {
console.error("Save error, retrying:", error);
setTimeout(() => {
database.ref('quizResults/' + responseId).set(quizData);
}, 500);
});
}

// Track active player
function trackActivePlayer(playerCode, action) {
if (!playerCode) return;

const playerRef = database.ref('activePlayers/' + playerCode);

if (action === 'join') {
playerRef.set({
joinedAt: new Date().toISOString(),
playerName: users.find(u => u.code === playerCode)?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
});
} else if (action === 'leave') {
playerRef.remove();
}
}

// Export functions
function exportToExcel() {
database.ref('quizResults').once('value')
.then((snapshot) => {
const results = snapshot.val();
if (!results) {
alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±.');
return;
}

const data = Object.values(results);
const worksheet = XLSX.utils.json_to_sheet(data);
const workbook = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(workbook, worksheet, "Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±");
XLSX.writeFile(workbook, 'Ù†ØªØ§Ø¦Ø¬-Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.xlsx');
alert('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­!');
})
.catch((error) => {
console.error("Error exporting to Excel:", error);
alert('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
});
}

function exportToCSV() {
database.ref('quizResults').once('value')
.then((snapshot) => {
const results = snapshot.val();
if (!results) {
alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±.');
return;
}

const data = Object.values(results);
const csv = convertToCSV(data);
const blob = new Blob([csv], { type: 'text/csv' });
const url = window.URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = 'Ù†ØªØ§Ø¦Ø¬-Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.csv';
a.click();
window.URL.revokeObjectURL(url);
alert('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù CSV Ø¨Ù†Ø¬Ø§Ø­!');
})
.catch((error) => {
console.error("Error exporting to CSV:", error);
alert('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
});
}

function convertToCSV(data) {
if (data.length === 0) return '';

const headers = Object.keys(data[0]);
const csvRows = [];
csvRows.push(headers.join(','));

for (const row of data) {
const values = headers.map(header => {
const value = row[header] || '';
if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
return `"${value.replace(/"/g, '""')}"`;
}
return value;
});
csvRows.push(values.join(','));
}

return csvRows.join('\n');
}

// Delete all quiz results
function deleteAllResults() {
database.ref('quizResults').remove()
.then(() => {
alert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!');
loadQuizResults();
})
.catch((error) => {
console.error("Error deleting results:", error);
alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù†ØªØ§Ø¦Ø¬. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
});
}

// Confirm before deleting results
function confirmDeleteResults() {
if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ\n\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
if (confirm('ğŸš¨ ØªØ­Ø°ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ: Ù‡Ø°Ø§ Ø³ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…. Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) {
deleteAllResults();
}
}
}

// Load and display quiz results
function loadQuizResults() {
const resultsContainer = document.getElementById('results-container');
resultsContainer.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</p>';

database.ref('quizResults').once('value')
.then((snapshot) => {
const results = snapshot.val();
resultsContainer.innerHTML = '';

if (!results) {
resultsContainer.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯. Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¬ÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.</p>';
return;
}

const resultsArray = Object.values(results);
const totalResponses = resultsArray.length;
const correctAnswers = resultsArray.filter(r => r.selectedAnswer === r.correctAnswer).length;
const accuracy = totalResponses > 0 ? ((correctAnswers / totalResponses) * 100).toFixed(1) : 0;
const avgResponseTime = totalResponses > 0 ?
(resultsArray.reduce((sum, r) => sum + (r.responseTime || 0), 0) / totalResponses).toFixed(2) : 0;

const uniquePlayers = new Set(resultsArray.map(r => r.playerCode)).size;

let resultsHTML = `
<div class="stats-container">
<h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
<div class="stats-grid">
<div class="stat-card">
<span class="stat-number">${uniquePlayers}</span>
<span class="stat-label">Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙØ±ÙŠØ¯ÙˆÙ†</span>
</div>
<div class="stat-card">
<span class="stat-number">${totalResponses}</span>
<span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</span>
</div>
<div class="stat-card">
<span class="stat-number">${correctAnswers}</span>
<span class="stat-label">Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©</span>
</div>
<div class="stat-card">
<span class="stat-number">${accuracy}%</span>
<span class="stat-label">Ø§Ù„Ø¯Ù‚Ø©</span>
</div>
<div class="stat-card">
<span class="stat-number">${avgResponseTime}Ø«Ø§Ù†ÙŠØ©</span>
<span class="stat-label">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</span>
</div>
</div>
</div>
`;

resultsHTML += '<div class="results-table">';
resultsHTML += '<div class="result-header">';
resultsHTML += '<span>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</span><span>Ø§Ù„Ø³Ø¤Ø§Ù„</span><span>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</span><span>Ø§Ù„ØµØ­ÙŠØ­Ø©</span><span>Ø§Ù„ÙˆÙ‚Øª</span><span>Ø§Ù„Ø­Ø§Ù„Ø©</span><span>Ø§Ù„Ø¬Ù‡Ø§Ø²</span><span>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</span>';
resultsHTML += '</div>';

resultsArray.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

resultsArray.forEach((result) => {
const isCorrect = result.selectedAnswer === result.correctAnswer;
const shortQuestion = result.question.length > 30 ?
result.question.substring(0, 30) + '...' : result.question;
const model = quizModels.find(m => m.id === result.modelId);
const modelName = model ? model.name : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬';

resultsHTML += `
<div class="result-row ${isCorrect ? 'correct' : 'incorrect'}">
<span>${result.playerName} (${result.playerCode})</span>
<span title="${result.question}">${shortQuestion}</span>
<span>${result.selectedAnswer}</span>
<span>${result.correctAnswer}</span>
<span>${result.responseTime}Ø«Ø§Ù†ÙŠØ©</span>
<span>${result.status}</span>
<span>${result.deviceType}</span>
<span>${modelName}</span>
</div>
`;
});

resultsHTML += '</div>';
resultsContainer.innerHTML = resultsHTML;
})
.catch((error) => {
console.error("Error loading results:", error);
resultsContainer.innerHTML = '<p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.</p>';
});
}

// Quiz Models Functions
function addQuizModel() {
var modelName = document.getElementById('model-name').value.trim();

if (!modelName) {
document.getElementById('model-status').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬';
document.getElementById('model-status').className = 'url-status error';
return;
}

// Check if model name already exists
if (quizModels.some(m => m.name.toLowerCase() === modelName.toLowerCase())) {
document.getElementById('model-status').textContent = 'Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹';
document.getElementById('model-status').className = 'url-status error';
return;
}

var newModel = {
id: 'model-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
name: modelName,
createdAt: new Date().toISOString()
};

quizModels.push(newModel);
saveQuizModelsToFirebase();

document.getElementById('model-status').textContent = 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('model-status').className = 'url-status success';

document.getElementById('model-name').value = '';

setTimeout(() => {
document.getElementById('model-status').textContent = 'Ø£Ù†Ø´Ø¦ Ù†Ù…Ø§Ø°Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø©';
document.getElementById('model-status').className = 'url-status';
}, 3000);
}

function displayQuizModels() {
var container = document.getElementById('models-container');
var modelSelect = document.getElementById('question-model');

container.innerHTML = '';
modelSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù†Ù…ÙˆØ°Ø¬Ù‹Ø§ --</option>';

if (quizModels.length === 0) {
container.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø¹Ø¯.</p>';
return;
}

quizModels.forEach((model, index) => {
const questionCount = questions.filter(q => q.modelId === model.id).length;

// Add to models container as clickable items
var modelItem = document.createElement('div');
modelItem.className = 'model-item';
modelItem.onclick = function() {
filterQuestionsByModel(model.id);
};

// Check if this model is the active one
const isActive = activeQuizModel === model.id;

modelItem.innerHTML = `
<div class="model-info">
<div class="model-name">${model.name} ${isActive ? 'â­' : ''}</div>
<div class="model-count">${questionCount} Ø£Ø³Ø¦Ù„Ø©</div>
</div>
<div class="model-controls">
${isActive ?
`<button class="model-btn deselect" onclick="event.stopPropagation(); deselectQuizModel()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>` :
`<button class="model-btn select" onclick="event.stopPropagation(); selectQuizModel('${model.id}')">ØªØ­Ø¯ÙŠØ¯</button>`
}
<button class="model-btn delete" onclick="event.stopPropagation(); deleteQuizModel(${index})">Ø­Ø°Ù</button>
<button class="model-btn" onclick="event.stopPropagation(); viewModelQuestions('${model.id}')" style="background: #2196f3;">Ø¹Ø±Ø¶</button>
</div>
`;
container.appendChild(modelItem);

// Add to model select dropdown
var option = document.createElement('option');
option.value = model.id;
option.textContent = model.name;
modelSelect.appendChild(option);
});
}

// View questions in a model
function viewModelQuestions(modelId) {
const model = quizModels.find(m => m.id === modelId);
const modelQuestions = questions.filter(q => q.modelId === modelId);

if (modelQuestions.length === 0) {
alert(`Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ "${model.name}".`);
return;
}

// Build the modal content
let modalContent = `
<h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ "${model.name}"</h3>
<p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ${modelQuestions.length}</p>
<div class="question-modal-answers">
`;

modelQuestions.forEach((q, index) => {
const correctIndex = q.answers.indexOf(q.correct);
modalContent += `
<div class="answer-item">
<strong>Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}:</strong> ${q.question}
<div style="margin-top: 10px;">
${q.answers.map((answer, i) => `
<div class="answer-item ${i === correctIndex ? 'correct' : ''}" style="margin: 5px 0; padding: 8px; border-radius: 4px;">
${i === correctIndex ? 'âœ… ' : 'âŒ '} ${answer}
</div>
`).join('')}
</div>
</div>
`;
});

modalContent += `</div>`;

document.getElementById('question-modal-body').innerHTML = modalContent;
document.getElementById('questionViewModal').style.display = 'block';
}

// View all questions
function viewAllQuestions() {
if (questions.length === 0) {
alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ§Ø­Ø©.');
return;
}

// Build the modal content
let modalContent = `
<h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
<p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ${questions.length}</p>
<div class="question-modal-answers">
`;

questions.forEach((q, index) => {
const model = quizModels.find(m => m.id === q.modelId);
const modelName = model ? model.name : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬';
const correctIndex = q.answers.indexOf(q.correct);

modalContent += `
<div class="answer-item">
<strong>Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1} (${modelName}):</strong> ${q.question}
<div style="margin-top: 10px;">
${q.answers.map((answer, i) => `
<div class="answer-item ${i === correctIndex ? 'correct' : ''}" style="margin: 5px 0; padding: 8px; border-radius: 4px;">
${i === correctIndex ? 'âœ… ' : 'âŒ '} ${answer}
</div>
`).join('')}
</div>
</div>
`;
});

modalContent += `</div>`;

document.getElementById('question-modal-body').innerHTML = modalContent;
document.getElementById('questionViewModal').style.display = 'block';
}

// Close question view modal
function closeQuestionView() {
document.getElementById('questionViewModal').style.display = 'none';
}

// Select a model for the quiz
function selectQuizModel(modelId) {
activeQuizModel = modelId;
saveActiveQuizModel(modelId);

const model = quizModels.find(m => m.id === modelId);
const modelName = model ? model.name : 'Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

document.getElementById('model-status').textContent = `"${modelName}" Ù‡Ùˆ Ø§Ù„Ø¢Ù† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø´Ø·. Ø³ÙŠØ±Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙ‚Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.`;
document.getElementById('model-status').className = 'url-status success';

// Update the display
displayQuizModels();
updateActiveModelDisplay();
updateDashboard();

setTimeout(() => {
document.getElementById('model-status').textContent = 'Ø£Ù†Ø´Ø¦ Ù†Ù…Ø§Ø°Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø©';
document.getElementById('model-status').className = 'url-status';
}, 5000);
}

// Deselect a model for the quiz
function deselectQuizModel() {
activeQuizModel = null;
saveActiveQuizModel(null);

document.getElementById('model-status').textContent = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬. Ø³ÙŠØ±Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.';
document.getElementById('model-status').className = 'url-status success';

// Update the display
displayQuizModels();
updateActiveModelDisplay();
updateDashboard();

setTimeout(() => {
document.getElementById('model-status').textContent = 'Ø£Ù†Ø´Ø¦ Ù†Ù…Ø§Ø°Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø©';
document.getElementById('model-status').className = 'url-status';
}, 5000);
}

// Filter questions by model
function filterQuestionsByModel(modelId) {
currentModelFilter = modelId;
const model = quizModels.find(m => m.id === modelId);
const modelName = model ? model.name : 'Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

// Update display header
document.getElementById('current-model-display').innerHTML = `- ${modelName}`;

// Display filtered questions
displayQuestions();
}

// Show all questions (clear filter)
function showAllQuestions() {
currentModelFilter = null;
document.getElementById('current-model-display').innerHTML = '';
displayQuestions();
}

function deleteQuizModel(index) {
const model = quizModels[index];
const modelQuestions = questions.filter(q => q.modelId === model.id);

if (modelQuestions.length > 0) {
if (!confirm(`Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${modelQuestions.length} Ø£Ø³Ø¦Ù„Ø©. Ø­Ø°ÙÙ‡ Ø³ÙŠØ²ÙŠÙ„ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ØŸ`)) {
return;
}

// Remove model association from questions instead of deleting them
questions.forEach(question => {
if (question.modelId === model.id) {
question.modelId = null;
question.modelName = null;
}
});
saveQuestionsToFirebase();
}

// If this was the active model, clear the active model
if (activeQuizModel === model.id) {
activeQuizModel = null;
saveActiveQuizModel(null);
}

quizModels.splice(index, 1);
saveQuizModelsToFirebase();
displayQuizModels();
updateDashboard();

// If we were viewing this model, show all questions
if (currentModelFilter === model.id) {
showAllQuestions();
}
}

// NEW FUNCTION: Recover questions with missing models
function recoverMissingModels() {
let recoveredCount = 0;
let assignedToDefault = 0;

questions.forEach(question => {
if (!question.modelId || question.modelId === "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬" || !quizModels.find(m => m.id === question.modelId)) {
// Try to find a model by name first
if (question.modelName && quizModels.length > 0) {
const model = quizModels.find(m => m.name === question.modelName);
if (model) {
question.modelId = model.id;
recoveredCount++;
return;
}
}

// If still no model, assign to first available model
if (quizModels.length > 0) {
const firstModel = quizModels[0];
question.modelId = firstModel.id;
question.modelName = firstModel.name;
assignedToDefault++;
}
}
});

if (recoveredCount > 0 || assignedToDefault > 0) {
saveQuestionsToFirebase();
displayQuestions();
let message = '';
if (recoveredCount > 0) message += `ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© ${recoveredCount} Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¨Ø¹Ù„Ø§Ù‚Ø§Øª Ù†Ù…ÙˆØ°Ø¬ Ù…ÙÙ‚ÙˆØ¯Ø©! `;
if (assignedToDefault > 0) message += `ØªÙ… ØªØ¹ÙŠÙŠÙ† ${assignedToDefault} Ø³Ø¤Ø§Ù„Ø§Ù‹ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.`;
alert(message);
} else {
alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ù…Ø§Ø°Ø¬ Ù…ÙÙ‚ÙˆØ¯Ø©.');
}
}

// NEW FUNCTION: Validate all models and questions
function validateAllModels() {
let issuesFound = 0;

// Check for questions with missing models
questions.forEach((question, index) => {
if (!question.modelId || !quizModels.find(m => m.id === question.modelId)) {
console.warn(`Ø§Ù„Ø³Ø¤Ø§Ù„ ${index} Ø¨Ù‡ Ù†Ù…ÙˆØ°Ø¬ Ù…ÙÙ‚ÙˆØ¯:`, question);
issuesFound++;
}
});

// Check for models with no questions
quizModels.forEach(model => {
const modelQuestions = questions.filter(q => q.modelId === model.id);
if (modelQuestions.length === 0) {
console.warn(`Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ "${model.name}" Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø©`);
issuesFound++;
}
});

if (issuesFound === 0) {
alert('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!');
} else {
alert(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${issuesFound} Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø±Ø¨Ø· Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„ØªÙØ§ØµÙŠÙ„.`);
}
}

// NEW FUNCTION: Debug model and question relationships
function debugModelQuestions() {
console.log("=== DEBUG: Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø© ===");
console.log("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬:", quizModels.length);
console.log("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:", questions.length);

quizModels.forEach(model => {
const modelQuestions = questions.filter(q => q.modelId === model.id);
console.log(`Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ "${model.name}" (${model.id}): ${modelQuestions.length} Ø£Ø³Ø¦Ù„Ø©`);

modelQuestions.forEach((q, index) => {
console.log(` Ø³${index + 1}: ${q.question.substring(0, 50)}...`);
});
});

// Check for questions without models
const orphanedQuestions = questions.filter(q => !q.modelId || !quizModels.find(m => m.id === q.modelId));
console.log("Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙŠØªÙŠÙ…Ø© (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬ ØµØ§Ù„Ø­):", orphanedQuestions.length);

orphanedQuestions.forEach((q, index) => {
console.log(` Ø³Ø¤Ø§Ù„ ÙŠØªÙŠÙ… ${index + 1}: ${q.question.substring(0, 50)}... (Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ${q.modelId})`);
});

alert(`Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØµØ­ÙŠØ­. ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„ØªÙØ§ØµÙŠÙ„.\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬: ${quizModels.length}\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ${questions.length}\nØ§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙŠØªÙŠÙ…Ø©: ${orphanedQuestions.length}`);
}

// Verify admin code
function verifyAdmin() {
var code = document.getElementById('admin-code').value;
var status = document.getElementById('admin-status');

document.getElementById('admin-code').value = '';

if (code === adminCode) {
document.getElementById('admin-features').style.display = 'block';
status.textContent = 'ØªÙ… Ù…Ù†Ø­ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ! ØªÙ… ÙØªØ­ Ø§Ù„Ù…ÙŠØ²Ø§Øª.';
status.className = 'url-status success';
loadQuizResults();
updateDashboard();

document.querySelector('.admin-section:first-child').style.display = 'none';
} else {
status.textContent = 'Ø±Ù…Ø² Ù…Ø³Ø¤ÙˆÙ„ ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
status.className = 'url-status error';
}
}

// Change admin password
function changeAdminPassword() {
var currentPassword = document.getElementById('current-password').value;
var newPassword = document.getElementById('new-password').value;
var confirmPassword = document.getElementById('confirm-password').value;
var status = document.getElementById('password-status');

if (currentPassword !== adminCode) {
status.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©.';
status.className = 'url-status error';
return;
}

if (newPassword !== confirmPassword) {
status.textContent = 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©.';
status.className = 'url-status error';
return;
}

if (newPassword.length < 4) {
status.textContent = 'ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.';
status.className = 'url-status error';
return;
}

adminCode = newPassword;
saveAdminPassword(newPassword);

status.textContent = 'ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!';
status.className = 'url-status success';

// Clear the form
document.getElementById('current-password').value = '';
document.getElementById('new-password').value = '';
document.getElementById('confirm-password').value = '';
}

// Save quiz time configuration
function saveHostQuizTime() {
var date = document.getElementById('host-quiz-date').value;
var hour = parseInt(document.getElementById('host-start-hour').value);
var minute = parseInt(document.getElementById('host-start-minute').value);
var ampm = document.getElementById('host-start-ampm').value;
var duration = document.getElementById('host-quiz-duration').value;

if (!date || isNaN(hour) || isNaN(minute) || !duration) {
document.getElementById('host-time-status').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­';
document.getElementById('host-time-status').className = 'url-status error';
return;
}

if (ampm === 'PM' && hour < 12) hour += 12;
else if (ampm === 'AM' && hour === 12) hour = 0;

var startDate = new Date(date);
startDate.setHours(hour, minute, 0, 0);
var endDate = new Date(startDate.getTime() + parseInt(duration) * 60000);

quizStartTime = startDate.getTime();
quizEndTime = endDate.getTime();

saveQuizTimeToFirebase(quizStartTime, quizEndTime);
updateQuizTimeInfo();
updateDashboard();

setTimeout(() => {
document.getElementById('host-time-status').textContent = 'ØªÙ… Ø­ÙØ¸ ØªÙƒÙˆÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
document.getElementById('host-time-status').className = 'url-status';
}, 3000);
}

// Add a new user
function addUser() {
var userName = document.getElementById('user-name').value;
var userCode = document.getElementById('user-code').value;

if (!userName || !userCode) {
document.getElementById('user-status').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„';
document.getElementById('user-status').className = 'url-status error';
return;
}

// Check if code already exists
if (users.some(u => u.code === userCode)) {
document.getElementById('user-status').textContent = 'Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‡Ø°Ø§ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
document.getElementById('user-status').className = 'url-status error';
return;
}

var newUser = {
name: userName,
code: userCode,
active: true
};

users.push(newUser);
saveUsersToFirebase();

document.getElementById('user-status').textContent = 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!';
document.getElementById('user-status').className = 'url-status success';

document.getElementById('user-name').value = '';
document.getElementById('user-code').value = '';

setTimeout(() => {
document.getElementById('user-status').textContent = 'Ø£Ø¶Ù Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø±Ù…ÙˆØ² Ø¯Ø®ÙˆÙ„ ÙØ±ÙŠØ¯Ø©';
document.getElementById('user-status').className = 'url-status';
}, 3000);
}

// Display all users
function displayUsers() {
var container = document.getElementById('users-container');
container.innerHTML = '';

if (users.length === 0) {
container.innerHTML = '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¨Ø¹Ø¯.</p>';
return;
}

users.forEach((user, index) => {
var userItem = document.createElement('div');
userItem.className = 'user-item';

userItem.innerHTML = `
<div class="user-info">
<div class="user-name">${user.name}</div>
<div class="user-code">Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„: ${user.code}</div>
</div>
<span class="user-status status-${user.active ? 'active' : 'inactive'}">
${user.active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
</span>
<div class="user-controls">
<button class="user-btn toggle" onclick="toggleUserStatus(${index})">
${user.active ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}
</button>
<button class="user-btn delete" onclick="deleteUser(${index})">Ø­Ø°Ù</button>
</div>
`;
container.appendChild(userItem);
});
}

// Toggle user status
function toggleUserStatus(index) {
users[index].active = !users[index].active;
saveUsersToFirebase();
displayUsers();
}

// Delete a user
function deleteUser(index) {
if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
users.splice(index, 1);
saveUsersToFirebase();
displayUsers();
}
}

// Add a new question - FIXED VERSION
function addQuestion() {
var questionText = document.getElementById('question-text').value;
var answer1 = document.getElementById('answer-1').value;
var answer2 = document.getElementById('answer-2').value;
var answer3 = document.getElementById('answer-3').value;
var answer4 = document.getElementById('answer-4').value;
var modelId = document.getElementById('question-model').value;

if (!questionText || !answer1 || !answer2 || !answer3 || !answer4) {
document.getElementById('question-status').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„';
document.getElementById('question-status').className = 'url-status error';
return;
}

if (!modelId) {
document.getElementById('question-status').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬';
document.getElementById('question-status').className = 'url-status error';
return;
}

// VALIDATE THAT THE SELECTED MODEL STILL EXISTS
const selectedModel = quizModels.find(m => m.id === modelId);
if (!selectedModel) {
document.getElementById('question-status').textContent = 'Ø®Ø·Ø£: Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù… ÙŠØ¹Ø¯ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬ ØµØ§Ù„Ø­.';
document.getElementById('question-status').className = 'url-status error';

// Refresh the model dropdown
displayQuizModels();
return;
}

var correctAnswerIndex = parseInt(document.querySelector('input[name="correct-answer"]:checked').value);
var answers = [answer1, answer2, answer3, answer4];
var correctAnswer = answers[correctAnswerIndex];

var newQuestion = {
question: questionText,
answers: answers,
correct: correctAnswer,
hidden: false,
modelId: modelId,
modelName: selectedModel.name,
timestamp: new Date().toISOString(),
questionId: 'q-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9)
};

questions.push(newQuestion);
saveQuestionsToFirebase();

document.getElementById('question-status').textContent = `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ "${selectedModel.name}"! Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ${questions.filter(q => q.modelId === modelId).length}`;
document.getElementById('question-status').className = 'url-status success';

// Clear form but KEEP the model selection
document.getElementById('question-text').value = '';
document.getElementById('answer-1').value = '';
document.getElementById('answer-2').value = '';
document.getElementById('answer-3').value = '';
document.getElementById('answer-4').value = '';
document.querySelector('input[name="correct-answer"][value="0"]').checked = true;

// Refresh questions display to show the new question
displayQuestions();
updateDashboard();

setTimeout(() => {
document.getElementById('question-status').textContent = 'Ø£Ø¶Ù Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
document.getElementById('question-status').className = 'url-status';
}, 4000);
}

// Display all questions with show/hide toggle
function displayQuestions() {
var container = document.getElementById('questions-container');
container.innerHTML = '';

// Add "Show All" button when filtered
if (currentModelFilter) {
const showAllButton = document.createElement('button');
showAllButton.className = 'admin-btn';
showAllButton.textContent = 'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©';
showAllButton.onclick = showAllQuestions;
showAllButton.style.marginBottom = '1rem';
container.appendChild(showAllButton);
}

let filteredQuestions = questions;

// Apply model filter if active
if (currentModelFilter) {
filteredQuestions = questions.filter(q => q.modelId === currentModelFilter);
}

if (filteredQuestions.length === 0) {
container.innerHTML += '<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø©.</p>';
return;
}

filteredQuestions.forEach((q, index) => {
// Find the actual index in the main questions array
const actualIndex = questions.findIndex(question => question === q);

var questionItem = document.createElement('div');
questionItem.className = 'question-item';
if (q.hidden) {
questionItem.classList.add('hidden');
}

var correctIndex = q.answers.indexOf(q.correct);
var status = q.hidden ? 'Ù…Ø®ÙÙŠ' : 'Ù…Ø±Ø¦ÙŠ';

// Get model name with fallback
var model = quizModels.find(m => m.id === q.modelId);
var modelName = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬';

if (model) {
modelName = model.name;
} else if (q.modelName) {
// If model ID not found but model name exists, try to find by name
modelName = q.modelName + ' (Ù…ÙÙ‚ÙˆØ¯)';

// Try to recover the model ID
const foundModel = quizModels.find(m => m.name === q.modelName);
if (foundModel) {
q.modelId = foundModel.id;
modelName = q.modelName;
// Auto-save the fix
setTimeout(saveQuestionsToFirebase, 1000);
}
}

// Calculate the question number within the current model
const modelQuestions = questions.filter(question => question.modelId === q.modelId);
const modelQuestionIndex = modelQuestions.indexOf(q) + 1;

questionItem.innerHTML = `
<strong>Ø³${modelQuestionIndex}:</strong> ${q.question}
<span class="model-badge">${modelName}</span>
<span class="status-badge status-${status}">${status.toUpperCase()}</span>
<div class="response-time">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${q.correct} (Ø§Ù„Ø®ÙŠØ§Ø± ${correctIndex + 1})</div>
<div class="admin-controls">
<button class="admin-btn edit" onclick="editExistingQuestion(${actualIndex})">ØªØ¹Ø¯ÙŠÙ„</button>
<button class="admin-btn toggle" onclick="toggleQuestionVisibility(${actualIndex})">
${q.hidden ? 'Ø¥Ø¸Ù‡Ø§Ø±' : 'Ø¥Ø®ÙØ§Ø¡'}
</button>
<button class="admin-btn delete" onclick="deleteQuestion(${actualIndex})">Ø­Ø°Ù</button>
<button class="admin-btn" onclick="viewQuestion(${actualIndex})" style="background: #2196f3;">Ø¹Ø±Ø¶</button>
</div>
`;
container.appendChild(questionItem);
});
}

// View a single question
function viewQuestion(index) {
const q = questions[index];
const model = quizModels.find(m => m.id === q.modelId);
const modelName = model ? model.name : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬';
const correctIndex = q.answers.indexOf(q.correct);

let modalContent = `
<h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„</h3>
<p><strong>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:</strong> ${modelName}</p>
<p><strong>Ø§Ù„Ø³Ø¤Ø§Ù„:</strong> ${q.question}</p>
<div class="question-modal-answers">
<h4>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</h4>
${q.answers.map((answer, i) => `
<div class="answer-item ${i === correctIndex ? 'correct' : ''}">
${i === correctIndex ? 'âœ… ' : 'âŒ '} ${answer}
</div>
`).join('')}
</div>
`;

document.getElementById('question-modal-body').innerHTML = modalContent;
document.getElementById('questionViewModal').style.display = 'block';
}

// Edit a question
function editExistingQuestion(index) {
var q = questions[index];

document.getElementById('question-text').value = q.question;
document.getElementById('answer-1').value = q.answers[0];
document.getElementById('answer-2').value = q.answers[1];
document.getElementById('answer-3').value = q.answers[2];
document.getElementById('answer-4').value = q.answers[3];
document.getElementById('question-model').value = q.modelId || '';

var correctIndex = q.answers.indexOf(q.correct);
document.querySelectorAll('input[name="correct-answer"]').forEach((radio, i) => {
radio.checked = (i === correctIndex);
});

questions.splice(index, 1);
saveQuestionsToFirebase();

document.getElementById('question-status').textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„. Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£Ø¹Ù„Ø§Ù‡ ÙˆØ§Ù†Ù‚Ø± "Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.';
document.getElementById('question-status').className = 'url-status success';

document.getElementById('question-text').scrollIntoView({ behavior: 'smooth' });
}

// Toggle question visibility
function toggleQuestionVisibility(index) {
questions[index].hidden = !questions[index].hidden;
saveQuestionsToFirebase();
displayQuestions();
}

// Delete a question
function deleteQuestion(index) {
if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) {
questions.splice(index, 1);
saveQuestionsToFirebase();
displayQuestions();
updateDashboard();
}
}

// Update quiz time info display
function updateQuizTimeInfo() {
var start = new Date(quizStartTime);
var end = new Date(quizEndTime);

var options = {
weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
hour: '2-digit', minute: '2-digit'
};

var timeRange = start.toLocaleDateString('ar-EG', options) + ' Ø¥Ù„Ù‰ ' +
end.toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit'});

document.getElementById('quiz-time-range').textContent = timeRange;

var now = new Date().getTime();
var quizTimer = document.getElementById('quiz-timer');
var quizStatus = document.getElementById('quiz-status-text');

if (now < quizStartTime) {
var timeUntilStart = Math.floor((quizStartTime - now) / 1000);
var hours = Math.floor(timeUntilStart / 3600);
var minutes = Math.floor((timeUntilStart % 3600) / 60);
var seconds = timeUntilStart % 60;

quizTimer.textContent = `â±ï¸ ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯: ${hours}Ø³ ${minutes}Ø¯ ${seconds}Ø«`;
quizStatus.textContent = 'Ù„Ù… ÙŠØ¨Ø¯Ø£';
quizStatus.style.color = '#ff9800';
quizActive = false;
stopRankingSystem(); // Stop ranking before quiz starts
} else if (now >= quizStartTime && now <= quizEndTime) {
var timeLeft = Math.floor((quizEndTime - now) / 1000);
var minutes = Math.floor(timeLeft / 60);
var seconds = timeLeft % 60;

quizTimer.textContent = `â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${minutes}Ø¯ ${seconds}Ø«`;
quizStatus.textContent = 'Ù†Ø´Ø·';
quizStatus.style.color = '#4caf50';
quizActive = true;
// Ranking system will start when players join
} else {
quizTimer.textContent = 'â±ï¸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
quizStatus.textContent = 'Ø§Ù†ØªÙ‡Ù‰';
quizStatus.style.color = '#f44336';
quizActive = false;
stopRankingSystem(); // Stop ranking after quiz ends
}
}

// Save quiz progress with fallback for incognito mode
function saveQuizProgress() {
var progress = {
currentIndex: currentIndex,
playerResults: playerResults,
timestamp: Date.now()
};

// Try sessionStorage first, fallback to localStorage for incognito
try {
sessionStorage.setItem('quizProgress', JSON.stringify(progress));
} catch (e) {
localStorage.setItem('quizProgress', JSON.stringify(progress));
}
}

// Resume quiz from saved progress with fallback for incognito mode
function resumeQuiz() {
playerCode = getStoredValue('playerCode');
var savedProgress = getStoredValue('quizProgress');

if (savedProgress) {
var progress = JSON.parse(savedProgress);
currentIndex = progress.currentIndex || 0;
playerResults = progress.playerResults || {
correct: 0,
incorrect: 0,
total: 0,
responseTimes: [],
accuracy: 0
};
}

document.getElementById("player-code").style.display = "none";
document.getElementById("joinBtn").style.display = "none";
document.getElementById('player-question').innerHTML = "";
showPlayerQuestion();
}

// Get stored value with fallback for incognito mode
function getStoredValue(key) {
// Try sessionStorage first
let value = sessionStorage.getItem(key);
if (value !== null) return value;

// Fallback to localStorage for incognito mode
value = localStorage.getItem(key);
return value;
}

// Set stored value with fallback for incognito mode
function setStoredValue(key, value) {
// Try sessionStorage first
try {
sessionStorage.setItem(key, value);
} catch (e) {
// Fallback to localStorage for incognito mode
localStorage.setItem(key, value);
}
}

// Remove stored value with fallback for incognito mode
function removeStoredValue(key) {
// Try sessionStorage first
try {
sessionStorage.removeItem(key);
} catch (e) {
// Fallback to localStorage for incognito mode
localStorage.removeItem(key);
}
}

// Reset quiz session with fallback for incognito mode
function resetQuizSession() {
removeStoredValue('quizCompleted');
removeStoredValue('quizStarted');
removeStoredValue('quizProgress');
removeStoredValue('playerCode');
location.reload();
}

// Countdown timer function
function startCountdown() {
timeLeft = 25;
document.getElementById('countdown').textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft}Ø«Ø§Ù†ÙŠØ©`;

clearInterval(countdownInterval);
countdownInterval = setInterval(() => {
timeLeft--;
document.getElementById('countdown').textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft}Ø«Ø§Ù†ÙŠØ©`;

if (timeLeft <= 0) {
clearInterval(countdownInterval);
var visibleQuestions = getVisibleQuestions();
var q = visibleQuestions[currentIndex];
var responseTime = (Date.now() - questionStartTime) / 1000;

// Find user name
const user = users.find(u => u.code === playerCode);
const userName = user ? user.name : 'Ù…Ø´Ø§Ø±Ùƒ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

saveToFirebase(playerCode, userName, q.question, "Ù„Ø§ Ø¥Ø¬Ø§Ø¨Ø©", q.correct, responseTime, "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©", q.modelId);

playerResults.incorrect++;
playerResults.total++;
playerResults.responseTimes.push(responseTime);
playerResults.accuracy = (playerResults.correct / playerResults.total) * 100;

saveQuizProgress();
moveToNextQuestion();
}
}, 1000);
}

// 2-second countdown before next question
function startNextQuestionCountdown() {
var countdownTime = 5;
document.getElementById('countdown').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ: ${countdownTime}Ø«Ø§Ù†ÙŠØ©`;
document.getElementById('countdown').style.color = "#1a3a5f";
document.getElementById('countdown').style.fontWeight = "bold";

var countdownInterval = setInterval(function() {
countdownTime--;
document.getElementById('countdown').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ: ${countdownTime}Ø«Ø§Ù†ÙŠØ©`;

if (countdownTime <= 0) {
clearInterval(countdownInterval);
document.getElementById('countdown').textContent = "";
moveToNextQuestion();
}
}, 1000);
}

// Get visible questions based on active model - FIXED VERSION
function getVisibleQuestions() {
let visibleQuestions = questions.filter(q => !q.hidden);

// If an active model is selected, filter questions by that model
if (activeQuizModel) {
console.log("ØªØµÙÙŠØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·:", activeQuizModel);
visibleQuestions = visibleQuestions.filter(q => {
const matches = q.modelId === activeQuizModel;
if (!matches) {
console.log("ØªÙ… ØªØµÙÙŠØ© Ø§Ù„Ø³Ø¤Ø§Ù„ - Ù…Ø¹Ø±Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:", q.modelId, "Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:", activeQuizModel);
}
return matches;
});
console.log("Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙÙŠØ©:", visibleQuestions.length);
} else {
console.log("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬ Ù†Ø´Ø· - Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ©:", visibleQuestions.length);
}

return visibleQuestions;
}

// Move to next question automatically
function moveToNextQuestion() {
currentIndex++;
var visibleQuestions = getVisibleQuestions();

if (currentIndex < visibleQuestions.length) {
saveQuizProgress();
showPlayerQuestion();
} else {
showPlayerResults();
}
}

// Show player results at the end of quiz with final rank
function showPlayerResults() {
// Stop ranking updates
stopRankingSystem();

// Mark quiz as completed immediately when user finishes last question
setStoredValue('quizCompleted', 'true');
removeStoredValue('quizProgress');
removeStoredValue('quizStarted');

// Track player leaving
trackActivePlayer(playerCode, 'leave');

var avgResponseTime = playerResults.responseTimes.length > 0
? (playerResults.responseTimes.reduce((a, b) => a + b, 0) / playerResults.responseTimes.length).toFixed(2)
: 0;

// Find user name
const user = users.find(u => u.code === playerCode);
const userName = user ? user.name : 'Ù…Ø´Ø§Ø±Ùƒ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

// Calculate pass/fail (50% threshold)
const accuracy = playerResults.accuracy;
const passFail = accuracy >= 50 ? 'Ù†Ø§Ø¬Ø­' : 'Ø±Ø§Ø³Ø¨';
const passFailClass = passFail === 'Ù†Ø§Ø¬Ø­' ? 'result-correct' : 'result-incorrect';

// Get final rank
const currentPlayerRank = playerRankings[playerCode];
const finalRank = currentPlayerRank ? currentPlayerRank.rank : 'ØºÙŠØ± Ù…ØªØ§Ø­';
const totalPlayers = Object.keys(playerRankings).length;

// Remove live rank display
const liveRankDisplay = document.getElementById('current-rank-display');
if (liveRankDisplay) {
liveRankDisplay.remove();
}

document.getElementById('player-question').innerHTML = `
<div class="player-results">
<h2>ğŸ‰ Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±! ğŸ‰</h2>
<p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŒ ${userName}!</p>

<!-- Final Rank Display -->
<div class="final-rank-section">
<div style="font-size: 1.2rem; margin-bottom: 10px; opacity: 0.9;">
ØªØ±ØªÙŠØ¨Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
</div>
<div style="font-size: 3.5rem; font-weight: bold; margin: 10px 0;">
#${finalRank}
</div>
<div style="font-size: 1rem; opacity: 0.8;">
Ù…Ù† Ø£ØµÙ„ ${totalPlayers} Ù…Ø´Ø§Ø±Ùƒ
</div>
${finalRank <= 3 ? `
<div style="margin-top: 15px; font-size: 1.5rem;">
${finalRank === 1 ? 'ğŸ¥‡ Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©!' : ''}
${finalRank === 2 ? 'ğŸ¥ˆ Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ© Ø§Ù„ÙØ¶ÙŠØ©!' : ''}
${finalRank === 3 ? 'ğŸ¥‰ Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ© Ø§Ù„Ø¨Ø±ÙˆÙ†Ø²ÙŠØ©!' : ''}
</div>
` : ''}
</div>

<div class="result-stats">
<div class="result-stat">
<span class="result-number result-correct">${playerResults.correct}</span>
<span class="result-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</span>
</div>
<div class="result-stat">
<span class="result-number result-incorrect">${playerResults.incorrect}</span>
<span class="result-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</span>
</div>
<div class="result-stat">
<span class="result-number result-accuracy">${playerResults.accuracy.toFixed(1)}%</span>
<span class="result-label">Ø§Ù„Ø¯Ù‚Ø©</span>
</div>
<div class="result-stat">
<span class="result-number result-time">${avgResponseTime}Ø«Ø§Ù†ÙŠØ©</span>
<span class="result-label">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</span>
</div>
<div class="result-stat">
<span class="result-number ${passFailClass}">${passFail}</span>
<span class="result-label">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</span>
</div>
</div>

<button class="download-btn" onclick="downloadPlayerResults()">
ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ÙŠ
</button>

<div class="session-warning">
<h3>âš ï¸ Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
<p>Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­.</p>
<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.</p>
</div>
</div>
`;

document.getElementById('player-answers').innerHTML = "";
document.getElementById('countdown').textContent = "";
}

// Download player results as CSV
function downloadPlayerResults() {
var avgResponseTime = playerResults.responseTimes.length > 0
? (playerResults.responseTimes.reduce((a, b) => a + b, 0) / playerResults.responseTimes.length).toFixed(2)
: 0;

// Find user name
const user = users.find(u => u.code === playerCode);
const userName = user ? user.name : 'Ù…Ø´Ø§Ø±Ùƒ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

// Calculate pass/fail
const accuracy = playerResults.accuracy;
const passFail = accuracy >= 50 ? 'Ù†Ø§Ø¬Ø­' : 'Ø±Ø§Ø³Ø¨';

var csvData = [
['Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ', 'Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ', 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©', 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©', 'Ø§Ù„Ø¯Ù‚Ø©', 'Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©', 'Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©'],
[userName, playerCode, playerResults.correct, playerResults.incorrect, playerResults.total, playerResults.accuracy.toFixed(1) + '%', avgResponseTime + 'Ø«Ø§Ù†ÙŠØ©', passFail]
];

var csv = csvData.map(row => row.join(',')).join('\n');
var blob = new Blob([csv], { type: 'text/csv' });
var url = window.URL.createObjectURL(blob);
var a = document.createElement('a');
a.href = url;
a.download = `Ù†ØªØ§Ø¦Ø¬-${userName}-${new Date().toISOString().split('T')[0]}.csv`;
a.click();
window.URL.revokeObjectURL(url);
}

// Real-time ranking system
// Start tracking player rankings
function startRankingSystem() {
// Clear any existing interval
if (rankingUpdateInterval) {
clearInterval(rankingUpdateInterval);
}

// Update rankings every 2 seconds during quiz
rankingUpdateInterval = setInterval(updatePlayerRankings, 2000);
}

// Stop ranking system
function stopRankingSystem() {
if (rankingUpdateInterval) {
clearInterval(rankingUpdateInterval);
rankingUpdateInterval = null;
}
}

// Update player rankings based on speed and accuracy
function updatePlayerRankings() {
database.ref('quizResults').once('value')
.then((snapshot) => {
const results = snapshot.val();
if (!results) return;

const allResults = Object.values(results);
const currentTime = Date.now();

// Filter results from the last 5 minutes for active players
const recentResults = allResults.filter(result =>
currentTime - new Date(result.timestamp).getTime() < 5 * 60 * 1000
);

// Calculate scores for each player
const playerScores = {};

recentResults.forEach(result => {
if (!playerScores[result.playerCode]) {
playerScores[result.playerCode] = {
correct: 0,
totalTime: 0,
questions: 0,
lastActivity: new Date(result.timestamp).getTime(),
playerName: result.playerName
};
}

const player = playerScores[result.playerCode];
player.questions++;

if (result.selectedAnswer === result.correctAnswer) {
player.correct++;
// Faster correct answers get higher scores
const speedBonus = Math.max(0, 15 - result.responseTime);
player.totalTime += result.responseTime;
}

player.lastActivity = Math.max(player.lastActivity, new Date(result.timestamp).getTime());
});

// Calculate ranking score (accuracy + speed)
const rankedPlayers = Object.entries(playerScores).map(([playerCode, data]) => {
const accuracy = data.questions > 0 ? (data.correct / data.questions) * 100 : 0;
const avgTime = data.correct > 0 ? (data.totalTime / data.correct) : 0;
const speedScore = Math.max(0, 100 - (avgTime * 10)); // Lower time = higher score
const activityRecency = (currentTime - data.lastActivity) < 60000 ? 50 : 0; // Bonus for recent activity

return {
playerCode,
playerName: data.playerName,
score: (accuracy * 0.6) + (speedScore * 0.3) + (activityRecency * 0.1),
correct: data.correct,
questions: data.questions,
accuracy: accuracy,
avgTime: avgTime
};
});

// Sort by score (descending)
rankedPlayers.sort((a, b) => b.score - a.score);

// Update global rankings
playerRankings = {};
rankedPlayers.forEach((player, index) => {
playerRankings[player.playerCode] = {
rank: index + 1,
...player
};
});

// Update ranking display for current player
updateCurrentPlayerRankDisplay();
})
.catch((error) => {
console.error("Error updating rankings:", error);
});
}

// Update current player's rank display
function updateCurrentPlayerRankDisplay() {
if (!playerCode || !quizActive) return;

const currentPlayerRank = playerRankings[playerCode];
const rankDisplay = document.getElementById('current-rank-display');

if (!rankDisplay) {
// Create rank display if it doesn't exist
const newRankDisplay = document.createElement('div');
newRankDisplay.id = 'current-rank-display';
newRankDisplay.className = 'rank-display';
document.body.appendChild(newRankDisplay);
}

const displayElement = document.getElementById('current-rank-display');

if (currentPlayerRank) {
const user = users.find(u => u.code === playerCode);
const userName = user ? user.name : 'Ø£Ù†Øª';

displayElement.innerHTML = `
<div style="font-weight: bold; margin-bottom: 8px; color: #1a3a5f;">ğŸ† Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div>
<div style="font-size: 1.5rem; font-weight: bold; color: #4caf50; text-align: center;">
#${currentPlayerRank.rank}
</div>
<div style="font-size: 0.9rem; text-align: center; margin-bottom: 8px;">
${userName}
</div>
<div style="font-size: 0.8rem; color: #666;">
ğŸ“Š ${currentPlayerRank.correct}/${currentPlayerRank.questions} ØµØ­ÙŠØ­Ø©
</div>
<div style="font-size: 0.8rem; color: #666;">
âš¡ Ù…ØªÙˆØ³Ø·: ${currentPlayerRank.avgTime ? currentPlayerRank.avgTime.toFixed(1) + 'Ø«Ø§Ù†ÙŠØ©' : 'ØºÙŠØ± Ù…ØªØ§Ø­'}
</div>
<div style="font-size: 0.8rem; color: #2196f3; margin-top: 5px;">
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†: ${Object.keys(playerRankings).length}
</div>
`;
} else {
displayElement.innerHTML = `
<div style="font-weight: bold; margin-bottom: 8px; color: #1a3a5f;">ğŸ† Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div>
<div style="text-align: center; color: #666; font-size: 0.9rem;">
Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ØªØ±Ù‰ ØªØ±ØªÙŠØ¨Ùƒ!
</div>
`;
}
}

// Initialize the application
document.getElementById("joinBtn").onclick = function() {
if (!quizActive) {
alert("Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.");
return;
}

// Improved session state management to prevent retaking quiz
if (getStoredValue('quizCompleted') === 'true') {
alert("Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„ÙØ¹Ù„. Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø®ØªØ¨Ø§Ø±Ù‡.");
return;
}

// Reset any incomplete quiz state
if (getStoredValue('quizStarted') === 'true' && !getStoredValue('quizCompleted')) {
if (!confirm("Ù„Ù‚Ø¯ Ø¨Ø¯Ø£Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„ÙØ¹Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ù† Ø­ÙŠØ« ØªÙˆÙ‚ÙØªØŸ")) {
// Clear the incomplete state if user doesn't want to continue
removeStoredValue('quizStarted');
removeStoredValue('quizProgress');
}
}

playerCode = document.getElementById("player-code").value.trim();
if (playerCode !== "") {
// Check if user code is valid and active
const user = users.find(u => u.code === playerCode);
if (!user) {
alert("Ø±Ù…Ø² Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø² ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
return;
}

if (!user.active) {
alert("Ø­Ø³Ø§Ø¨Ùƒ ØºÙŠØ± Ù†Ø´Ø·. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ø´Ø±Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.");
return;
}

// Mark quiz as started
setStoredValue('quizStarted', 'true');
setStoredValue('playerCode', playerCode);

// Track active player
trackActivePlayer(playerCode, 'join');

// Reset results when starting new quiz
playerResults = {
correct: 0,
incorrect: 0,
total: 0,
responseTimes: [],
accuracy: 0
};

// Restore progress if exists
var savedProgress = getStoredValue('quizProgress');
if (savedProgress) {
var progress = JSON.parse(savedProgress);
currentIndex = progress.currentIndex || 0;
playerResults = progress.playerResults || playerResults;
}

// START RANKING SYSTEM WHEN PLAYER JOINS
startRankingSystem();

currentIndex = 0;
document.getElementById("player-code").style.display = "none";
document.getElementById("joinBtn").style.display = "none";
showPlayerQuestion();
} else {
alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©.");
}
};

// Update quiz timer every second
setInterval(updateQuizTimeInfo, 1000);
updateQuizTimeInfo();

// Improved session state management to prevent lag issues
window.addEventListener('beforeunload', function (e) {
if (getStoredValue('quizStarted') === 'true' && getStoredValue('quizCompleted') !== 'true') {
// Save progress before leaving
saveQuizProgress();
// Track player leaving
trackActivePlayer(playerCode, 'leave');
e.preventDefault();
e.returnValue = 'Ù„Ø¯ÙŠÙƒ Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ';
return 'Ù„Ø¯ÙŠÙƒ Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ';
}
});

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
document.querySelectorAll('.tab-content').forEach(tab => {
tab.classList.remove('active');
});
document.getElementById('player').classList.add('active');

// Wait for Firebase to load before showing quiz status
function checkQuizStatusAfterLoad() {
// Check if user already completed quiz (after Firebase loads)
if (getStoredValue('quizCompleted') === 'true') {
const playerCode = getStoredValue('playerCode') || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
const user = users.find(u => u.code === playerCode);
const userName = user ? user.name : 'Ù…Ø´Ø§Ø±Ùƒ';

document.getElementById('player-question').innerHTML = `
<div class="player-results">
<h2>ğŸ Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„ÙØ¹Ù„</h2>
<p>Ù…Ø±Ø­Ø¨Ø§Ù‹ <strong>${userName}</strong>ØŒ Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!</p>
<div class="session-warning">
<h3>âš ï¸ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</h3>
<p>ÙŠÙ…ÙƒÙ† Ù„ÙƒÙ„ Ù…Ø´Ø§Ø±Ùƒ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.</p>
</div>
</div>
`;
document.getElementById("player-code").style.display = "none";
// Disable the join button instead of hiding it
document.getElementById("joinBtn").disabled = true;
document.getElementById("joinBtn").style.background = "#ccc";
document.getElementById("joinBtn").textContent = "Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±";
document.getElementById("joinBtn").style.cursor = "not-allowed";
}
}

function initializeApp() {
try {
loadDataFromFirebase();
// Check status again after Firebase fully loads
setTimeout(checkQuizStatusAfterLoad, 2000);
} catch (error) {
setTimeout(initializeApp, 2000);
}
}
initializeApp();
console.log("ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙ†ÙŠÙ");
});
</script>
</body>
</html>
