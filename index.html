<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Game with Admin Features</title>
<style>
/* ---------- Your full CSS from original 1200-line code ---------- */
/* Keep everything unchanged from your original code */
* {margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
body {background:linear-gradient(135deg,#6a11cb 0%,#2575fc 100%); color:#333; line-height:1.6; min-height:100vh; padding:20px; display:flex; justify-content:center; align-items:center;}
.container {width:95%; max-width:1000px; background:white; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.2); overflow:hidden;}
header {background:linear-gradient(135deg,#6e8efb,#a777e3); color:white; padding:2rem; text-align:center; position:relative;}
.quiz-timer {position:absolute; top:10px; right:20px; background:rgba(255,255,255,0.2); padding:5px 10px; border-radius:20px; font-weight:bold;}
/* ---------- Continue all your existing CSS unchanged ---------- */
</style>
</head>
<body>
<div class="container">
<header>
<h1>Quiz Game with Admin Features</h1>
<p class="subtitle">Answer questions within the time limit</p>
<div class="quiz-timer" id="quiz-timer">Quiz: Not started</div>
</header>

<div class="tabs">
<div class="tab active" onclick="switchTab('player')">Player</div>
<div class="tab" onclick="switchTab('host')">Host</div>
<div class="tab" id="setup-tab" onclick="switchTab('setup')">Setup</div>
</div>

<div class="content">
<!-- Player Tab -->
<div id="player" class="tab-content active">
<h2>Join Quiz</h2>
<div class="time-info" id="quiz-time-info">
<p>This quiz is scheduled for <strong id="quiz-time-range">loading...</strong></p>
<p id="quiz-status">Status: <span id="quiz-status-text">Not started</span></p>
</div>

<div class="card">
<input id="name" placeholder="Enter your name">
<button id="joinBtn">Join Game</button>

<div id="player-question"></div>
<div id="countdown" class="countdown"></div>
<div id="player-answers"></div>
</div>

<div class="instructions">
<h3>Player Instructions</h3>
<ol>
<li>Enter your name and click "Join Game"</li>
<li>Wait for the host to start the quiz</li>
<li>Select your answer when questions appear</li>
<li>Your answers and response time will be recorded</li>
</ol>
</div>
</div>

<!-- Host Tab -->
<div id="host" class="tab-content">
<h2>Quiz Host (Admin)</h2>

<div class="admin-section">
<h3>Admin Access</h3>
<div class="form-group">
<label for="admin-code">Enter Admin Code:</label>
<input type="password" id="admin-code" placeholder="Enter admin code">
<button onclick="verifyAdmin()">Access Admin Features</button>
</div>
<div id="admin-status" class="url-status">Enter the admin code to access host features</div>
</div>

<div id="admin-features" style="display: none;">
<!-- Quiz timing configuration -->
<div class="time-config">
<h3>Quiz Timing Configuration</h3>
<div class="form-group">
<label for="host-quiz-date">Quiz Date:</label>
<input type="date" id="host-quiz-date">
</div>
<div class="form-group">
<label for="host-start-time">Start Time:</label>
<div class="time-input-group">
<input type="number" id="host-start-hour" min="1" max="12" value="12" placeholder="Hour">
<input type="number" id="host-start-minute" min="0" max="59" value="0" placeholder="Minute">
<select id="host-start-ampm">
<option value="AM">AM</option>
<option value="PM" selected>PM</option>
</select>
</div>
</div>
<div class="form-group">
<label for="host-quiz-duration">Quiz Duration (minutes):</label>
<select id="host-quiz-duration">
<option value="15">15 minutes</option>
<option value="30" selected>30 minutes</option>
<option value="45">45 minutes</option>
<option value="60">1 hour</option>
<option value="90">1.5 hours</option>
<option value="120">2 hours</option>
</select>
</div>
<button onclick="saveHostQuizTime()">Save Quiz Time</button>
<div id="host-time-status" class="url-status">Configure when your quiz will be active</div>
</div>

<!-- Question Management -->
<div class="admin-section">
<h3>Question Management</h3>
<div class="form-group">
<label for="question-text">Question:</label>
<textarea id="question-text" placeholder="Enter your question"></textarea>
</div>

<div class="form-group">
<label>Answer Options:</label>
<div class="answer-option">
<input type="text" id="answer-1" placeholder="Enter answer 1">
<input type="radio" name="correct-answer" value="0" checked> Correct Answer
</div>
<div class="answer-option">
<input type="text" id="answer-2" placeholder="Enter answer 2">
<input type="radio" name="correct-answer" value="1"> Correct Answer
</div>
<div class="answer-option">
<input type="text" id="answer-3" placeholder="Enter answer 3">
<input type="radio" name="correct-answer" value="2"> Correct Answer
</div>
<div class="answer-option">
<input type="text" id="answer-4" placeholder="Enter answer 4">
<input type="radio" name="correct-answer" value="3"> Correct Answer
</div>
</div>
<button onclick="addQuestion()">Add Question</button>
<div id="question-status" class="url-status">Add a new question to the quiz</div>
</div>

<div class="question-list">
<h3>Current Questions</h3>
<div id="questions-container"></div>
</div>
</div>

<!-- Setup Tab -->
<div id="setup" class="tab-content">
<h2>Google Sheets Setup</h2>
<div id="setup-complete-message" class="setup-complete" style="display: none;">
<h3>âœ… Setup Complete!</h3>
<p>Your Google Sheets integration is configured. You can now use the Player and Host tabs.</p>
<button onclick="switchTab('player')">Go to Player Tab</button>
</div>

<div id="setup-form">
<div class="sheet-config">
<h3>How to Configure Google Sheets Integration</h3>
<p>To connect your quiz app to Google Sheets, you need to create a Google Apps Script web app:</p>
<ol>
<li>Create a new Google Sheet</li>
<li>Click on "Extensions" > "Apps Script"</li>
<li>Replace the default code with the provided script</li>
<li>Deploy as a web app with "Execute as me" and "Anyone" access</li>
<li>Copy the web app URL and paste it in the field below</li>
</ol>
</div>

<div class="card">
<h3>Web App URL Configuration</h3>
<input type="text" id="webAppUrl" placeholder="https://script.google.com/macros/s/XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/exec">
<button onclick="saveWebAppUrl()">Save URL</button>
<div id="urlStatus" class="url-status">Please enter your Google Apps Script URL</div>
</div>
</div>
</div>
</div>

<script>
// ---------- Full JavaScript logic ----------

// Tab switching
function switchTab(tabName) {
document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
document.getElementById(tabName).classList.add('active');
document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
event.target.classList.add('active');
if(tabName==='host'){loadHostTimeSettings();}
}

// Quiz variables
var questions = [];
var currentIndex=0, playerName="", countdownInterval, timeLeft=15, questionStartTime, quizActive=false, adminCode="admin123";
var quizStartTime=0, quizEndTime=0;

// Web app URL
var webAppUrl = localStorage.getItem('webAppUrl')||'';
document.getElementById('webAppUrl').value = webAppUrl;

// ---------- Fetch latest questions and time periodically ----------
function fetchUpdates(){
if(!webAppUrl) return;
fetch(webAppUrl+'?action=get').then(r=>r.json()).then(data=>{
if(data.questions) {questions = data.questions; displayQuestions();}
if(data.quizStartTime) {quizStartTime = data.quizStartTime; quizEndTime = data.quizEndTime; updateQuizStatus();}
}).catch(e=>console.error(e));
}
setInterval(fetchUpdates, 5000); // every 5 seconds

// ---------- Save Host Quiz Time ----------
function saveHostQuizTime(){
var date = document.getElementById('host-quiz-date').value;
var hour = parseInt(document.getElementById('host-start-hour').value);
var min = parseInt(document.getElementById('host-start-minute').value);
var ampm = document.getElementById('host-start-ampm').value;
if(ampm==="PM" && hour<12) hour+=12;
if(ampm==="AM" && hour===12) hour=0;
var startTime = new Date(date+'T'+hour.toString().padStart(2,'0')+':'+min.toString().padStart(2,'0')+':00').getTime();
var duration = parseInt(document.getElementById('host-quiz-duration').value)*60000;
var endTime = startTime+duration;
fetch(webAppUrl+'?action=setTime&start='+startTime+'&end='+endTime).then(r=>r.json()).then(res=>{
document.getElementById('host-time-status').innerText="Quiz time saved!";
fetchUpdates();
}).catch(e=>console.error(e));
}

// ---------- Add Question ----------
function addQuestion(){
var q = document.getElementById('question-text').value;
var a1 = document.getElementById('answer-1').value;
var a2 = document.getElementById('answer-2').value;
var a3 = document.getElementById('answer-3').value;
var a4 = document.getElementById('answer-4').value;
var correct = parseInt(document.querySelector('input[name="correct-answer"]:checked').value);
var newQuestion = {question:q, options:[a1,a2,a3,a4], correct:correct};
fetch(webAppUrl+'?action=addQuestion', {method:'POST', body:JSON.stringify(newQuestion)}).then(r=>r.json()).then(res=>{
document.getElementById('question-status').innerText="Question added!";
fetchUpdates();
}).catch(e=>console.error(e));
}

// ---------- Display Questions in Admin ----------
function displayQuestions(){
var container = document.getElementById('questions-container');
container.innerHTML = '';
questions.forEach((q,i)=>{var div = document.createElement('div'); div.innerText=(i+1)+". "+q.question; container.appendChild(div);});
}

// ---------- Player Join ----------
document.getElementById('joinBtn').addEventListener('click', function(){
playerName=document.getElementById('name').value.trim();
if(!playerName){alert("Enter your name"); return;}
currentIndex=0;
displayPlayerQuestion();
});

// ---------- Display Player Question ----------
function displayPlayerQuestion(){
if(!quizActive){document.getElementById('player-question').innerText="Quiz not active yet."; return;}
if(currentIndex>=questions.length){document.getElementById('player-question').innerText="Quiz finished!"; return;}
var q=questions[currentIndex];
document.getElementById('player-question').innerHTML=`<p>${q.question}</p>`;
var ansDiv=document.getElementById('player-answers');
ansDiv.innerHTML="";
q.options.forEach((o,i)=>{
var btn=document.createElement('button');
btn.innerText=o;
btn.onclick=function(){submitAnswer(i);}
ansDiv.appendChild(btn);
});
questionStartTime=Date.now();
timeLeft=15;
startCountdown();
}

// ---------- Submit Answer ----------
function submitAnswer(optionIndex){
var q=questions[currentIndex];
var correct=q.correct;
var timeTaken=(Date.now()-questionStartTime)/1000;
alert(`You selected: ${q.options[optionIndex]}. Correct: ${q.options[correct]}. Time: ${timeTaken.toFixed(2)}s`);
currentIndex++; displayPlayerQuestion();
}

// ---------- Countdown ----------
function startCountdown(){
clearInterval(countdownInterval);
countdownInterval=setInterval(()=>{
timeLeft--;
document.getElementById('countdown').innerText=`Time left: ${timeLeft}s`;
if(timeLeft<=0){clearInterval(countdownInterval); submitAnswer(-1);}
},1000);
}

// ---------- Admin Verification ----------
function verifyAdmin(){
var code=document.getElementById('admin-code').value;
if(code===adminCode){document.getElementById('admin-features').style.display='block'; document.getElementById('admin-status').innerText="Access granted";}
else{alert("Wrong admin code");}
}

// ---------- Save Web App URL ----------
function saveWebAppUrl(){
webAppUrl=document.getElementById('webAppUrl').value;
localStorage.setItem('webAppUrl', webAppUrl);
document.getElementById('urlStatus').innerText="URL saved!";
fetchUpdates();
}

// ---------- Load Host Time Settings ----------
function loadHostTimeSettings(){
if(!webAppUrl) return;
fetch(webAppUrl+'?action=getTime').then(r=>r.json()).then(res=>{
if(res.start){quizStartTime=res.start; quizEndTime=res.end; updateQuizStatus();}
}).catch(e=>console.error(e));
}

// ---------- Update Quiz Status ----------
function updateQuizStatus(){
var now=Date.now();
if(now>=quizStartTime && now<=quizEndTime){quizActive=true; document.getElementById('quiz-status-text').innerText="Active";}
else if(now<quizStartTime){quizActive=false; document.getElementById('quiz-status-text').innerText="Upcoming";}
else{quizActive=false; document.getElementById('quiz-status-text').innerText="Ended";}
document.getElementById('quiz-time-range').innerText=new Date(quizStartTime).toLocaleString()+" - "+new Date(quizEndTime).toLocaleString();
}

// Initial fetch
fetchUpdates();
</script>
</body>
</html>
