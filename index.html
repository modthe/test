<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Game with Google Sheets Integration</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
color: #333;
line-height: 1.6;
min-height: 100vh;
padding: 20px;
display: flex;
justify-content: center;
align-items: center;
}

.container {
width: 95%;
max-width: 1000px;
background: white;
border-radius: 12px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
overflow: hidden;
}

header {
background: linear-gradient(135deg, #6e8efb, #a777e3);
color: white;
padding: 2rem;
text-align: center;
position: relative;
}

.quiz-timer {
position: absolute;
top: 10px;
right: 20px;
background: rgba(255, 255, 255, 0.2);
padding: 5px 10px;
border-radius: 20px;
font-weight: bold;
}

h1 {
font-size: 2.2rem;
margin-bottom: 1rem;
}

.subtitle {
font-size: 1.1rem;
opacity: 0.9;
}

.tabs {
display: flex;
background: #f0f0f0;
border-bottom: 2px solid #ddd;
}

.tab {
padding: 1rem;
cursor: pointer;
font-weight: 600;
transition: all 0.3s ease;
text-align: center;
flex: 1;
font-size: 0.9rem;
}

.tab:hover {
background: #e0e0e0;
}

.tab.active {
background: white;
border-bottom: 3px solid #6e8efb;
}

.content {
padding: 1.5rem;
min-height: 500px;
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

.card {
background: white;
border-radius: 10px;
padding: 1.5rem;
margin: 1.5rem 0;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
border-left: 4px solid #6e8efb;
}

h2 {
font-size: 1.6rem;
color: #6e8efb;
margin-bottom: 1rem;
}

h3 {
font-size: 1.3rem;
color: #a777e3;
margin: 1.2rem 0 0.8rem;
}

input, button, select, textarea {
padding: 0.8rem 1rem;
margin: 0.5rem 0;
border-radius: 5px;
border: 1px solid #ddd;
font-size: 0.9rem;
}

input, select, textarea {
width: 100%;
max-width: 300px;
}

textarea {
min-height: 100px;
resize: vertical;
}

button {
background: #6e8efb;
color: white;
border: none;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 600;
}

button:hover {
background: #5a7df9;
transform: translateY(-2px);
}

button:disabled {
background: #ccc;
cursor: not-allowed;
transform: none;
}

.answer-btn {
display: block;
width: 100%;
text-align: left;
margin: 0.5rem 0;
padding: 1rem;
background: #f8f9fa;
color: #333;
border: 1px solid #ddd;
transition: all 0.2s ease;
}

.answer-btn:hover {
background: #e9ecef;
transform: translateX(5px);
}

.answer-btn.correct {
background-color: #4caf50;
color: white;
border-color: #4caf50;
}

.answer-btn.incorrect {
background-color: #f44336;
color: white;
border-color: #f44336;
}

.instructions {
background: #fff8e1;
border-left: 4px solid #ffc107;
padding: 1.2rem;
margin: 1.5rem 0;
border-radius: 4px;
}

.instructions h3 {
color: #ff9800;
margin-bottom: 0.8rem;
}

.instructions ol {
margin-left: 1.5rem;
margin-bottom: 1rem;
}

.instructions li {
margin-bottom: 0.5rem;
}

.sheet-config {
background: #e8f5e9;
border-left: 4px solid #4caf50;
padding: 1.2rem;
margin: 1.5rem 0;
border-radius: 4px;
}

.sheet-config h3 {
color: #2e7d32;
margin-bottom: 0.8rem;
}

.code-block {
background: #2c3e50;
color: #f5f7fa;
padding: 1.2rem;
border-radius: 8px;
font-family: monospace;
margin: 1.2rem 0;
overflow-x: auto;
font-size: 0.9rem;
}

.countdown {
font-size: 1.4rem;
font-weight: bold;
text-align: center;
margin: 1rem 0;
color: #6e8efb;
}

.url-status {
margin-top: 10px;
padding: 8px;
border-radius: 4px;
text-align: center;
font-size: 0.9rem;
}

.url-status.success {
background-color: #d4edda;
color: #155724;
border: 1px solid #c3e6cb;
}

.url-status.error {
background-color: #f8d7da;
color: #721c24;
border: 1px solid #f5c6cb;
}

.setup-complete {
text-align: center;
padding: 1.5rem;
background: #e8f5e9;
border-radius: 8px;
margin: 1.5rem 0;
}

.time-info {
background: #e3f2fd;
border-left: 4px solid #2196f3;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.time-config {
background: #f3e5f5;
border-left: 4px solid #9c27b0;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.time-config h3 {
color: #7b1fa2;
}

.form-group {
margin: 1rem 0;
}

label {
display: block;
margin-bottom: 0.5rem;
font-weight: 600;
}

.admin-section {
background: #fff3e0;
border-left: 4px solid #ff9800;
padding: 1.2rem;
margin: 1.2rem 0;
border-radius: 4px;
}

.admin-section h3 {
color: #ef6c00;
}

.question-list {
margin: 1rem 0;
max-height: 300px;
overflow-y: auto;
border: 1px solid #ddd;
border-radius: 5px;
padding: 1rem;
background: #f9f9f9;
}

.question-item {
padding: 0.5rem;
border-bottom: 1px solid #eee;
}

.question-item:last-child {
border-bottom: none;
}

.admin-controls {
display: flex;
gap: 10px;
margin-top: 0.5rem;
}

.admin-btn {
padding: 0.3rem 0.8rem;
font-size: 0.8rem;
}

.admin-btn.edit {
background: #ff9800;
}

.admin-btn.delete {
background: #f44336;
}

.answer-option {
display: flex;
align-items: center;
margin-bottom: 0.5rem;
}

.answer-option input[type="text"] {
flex: 1;
margin-right: 10px;
}

.response-time {
font-style: italic;
color: #666;
font-size: 0.9rem;
margin-top: 5px;
}

.time-input-group {
display: flex;
align-items: center;
gap: 10px;
}

.time-input-group input {
max-width: 120px;
}

.time-input-group select {
max-width: 80px;
}

.firebase-config-help {
background: #ffebee;
border-left: 4px solid #f44336;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.firebase-config-help h3 {
color: #c62828;
}

.test-section {
background: #e8f5e9;
border-left: 4px solid #4caf50;
padding: 1rem;
margin: 1rem 0;
border-radius: 4px;
}

.test-section h3 {
color: #2e7d32;
}

@media (max-width: 768px) {
.tabs {
flex-direction: column;
}

h1 {
font-size: 1.8rem;
}

.content {
padding: 1rem;
}

.quiz-timer {
position: static;
margin-top: 10px;
display: inline-block;
}

.admin-controls {
flex-direction: column;
}

.answer-option {
flex-direction: column;
align-items: flex-start;
}

.answer-option input[type="text"] {
width: 100%;
margin-right: 0;
margin-bottom: 5px;
}

.time-input-group {
flex-direction: column;
align-items: flex-start;
}
}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Quiz Game with Google Sheets Integration</h1>
<p class="subtitle">Answer questions and send data to Google Sheets</p>
<div class="quiz-timer" id="quiz-timer">Quiz: Not started</div>
</header>

<div class="tabs">
<div class="tab active" onclick="switchTab('player')">Player</div>
<div class="tab" onclick="switchTab('setup')">Google Sheets Setup</div>
<div class="tab" onclick="switchTab('test')">Test Integration</div>
</div>

<div class="content">
<!-- Player Tab -->
<div id="player" class="tab-content active">
<h2>Join Quiz</h2>
<div class="time-info" id="quiz-time-info">
<p>This quiz is scheduled for <strong id="quiz-time-range">anytime</strong></p>
<p id="quiz-status">Status: <span id="quiz-status-text">Ready to play</span></p>
</div>

<div class="card">
<input id="name" placeholder="Enter your name">
<button id="joinBtn">Join Game</button>

<div id="player-question"></div>
<div id="countdown" class="countdown"></div>
<div id="player-answers"></div>
</div>

<div class="instructions">
<h3>Player Instructions</h3>
<ol>
<li>Enter your name and click "Join Game"</li>
<li>Answer the questions when they appear</li>
<li>Your answers will be sent to Google Sheets</li>
</ol>
</div>
</div>

<!-- Setup Tab -->
<div id="setup" class="tab-content">
<h2>Google Sheets Setup</h2>

<div id="setup-complete-message" class="setup-complete" style="display: none;">
<h3>âœ… Setup Complete!</h3>
<p>Your Google Sheets integration is configured. You can now use the Player tab.</p>
<button onclick="switchTab('player')">Go to Player Tab</button>
</div>

<div id="setup-form">
<div class="sheet-config">
<h3>How to Configure Google Sheets Integration</h3>
<p>To connect your quiz app to Google Sheets, you need to create a Google Apps Script web app:</p>
<ol>
<li>Create a new Google Sheet</li>
<li>Click on "Extensions" > "Apps Script"</li>
<li>Replace the default code with the provided script</li>
<li>Deploy as a web app with "Execute as me" and "Anyone" access</li>
<li>Copy the web app URL and paste it in the field below</li>
</ol>
</div>

<div class="card">
<h3>Web App URL Configuration</h3>
<input type="text" id="webAppUrl" placeholder="https://script.google.com/macros/s/.../exec">
<button onclick="saveWebAppUrl()">Save URL</button>
<div id="urlStatus" class="url-status">Please enter your Google Apps Script URL</div>
</div>

<div class="code-block">
<p>// Google Apps Script code for your Google Sheet</p>
<pre>
function doPost(e) {
try {
// Open the active spreadsheet and get the 'Quiz Results' sheet
var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Quiz Results");

// If the sheet doesn't exist, create it
if (!sheet) {
sheet = SpreadsheetApp.getActiveSpreadsheet().insertSheet("Quiz Results");
sheet.appendRow(["Timestamp", "Player", "Question", "Selected Answer", "Correct Answer", "Response Time (seconds)", "Status"]);
}

// Parse the incoming data
var data = JSON.parse(e.postData.contents);

// Append the new row
sheet.appendRow([
new Date(),
data.player,
data.question,
data.answer,
data.correct,
data.responseTime,
data.status
]);

// Return success
return ContentService.createTextOutput(JSON.stringify({result: "Success", message: "Data saved successfully"}))
.setMimeType(ContentService.MimeType.JSON);

} catch (error) {
// Return an error message
return ContentService.createTextOutput(JSON.stringify({result: "Error", message: error.toString()}))
.setMimeType(ContentService.MimeType.JSON)
.setStatusCode(500);
}
}

// For testing purposes
function doGet(e) {
return ContentService.createTextOutput(JSON.stringify({result: "Success", message: "Web app is working!"}))
.setMimeType(ContentService.MimeType.JSON);
}
</pre>
</div>
</div>
</div>

<!-- Test Tab -->
<div id="test" class="tab-content">
<h2>Test Google Sheets Integration</h2>

<div class="test-section">
<h3>Test Connection</h3>
<p>Click the button below to test if your Google Sheets connection is working:</p>
<button onclick="testGoogleSheetsConnection()">Test Connection</button>
<div id="testConnectionStatus" class="url-status">Test not run yet</div>
</div>

<div class="test-section">
<h3>Send Sample Data</h3>
<p>Click the button below to send sample data to your Google Sheet:</p>
<button onclick="sendSampleData()">Send Sample Data</button>
<div id="sampleDataStatus" class="url-status">Sample data not sent yet</div>
</div>

<div class="instructions">
<h3>Troubleshooting Tips</h3>
<ol>
<li>Make sure you've deployed your Google Apps Script as a web app</li>
<li>Set "Execute as me" and "Anyone" access permissions</li>
<li>Check your browser's console for error messages (F12)</li>
<li>Ensure your Google Sheet has a sheet named "Quiz Results"</li>
<li>Try the test connection first before sending player data</li>
</ol>
</div>
</div>
</div>
</div>

<script>
// Tab switching functionality
function switchTab(tabName) {
// Hide all tab contents
document.querySelectorAll('.tab-content').forEach(tab => {
tab.classList.remove('active');
});

// Show selected tab content
document.getElementById(tabName).classList.add('active');

// Update active tab
document.querySelectorAll('.tab').forEach(tab => {
tab.classList.remove('active');
});

// Activate the clicked tab
event.target.classList.add('active');
}

// Initialize variables
var questions = [
{
question: "What is 2 + 2?",
answers: ["3", "4", "5", "6"],
correct: "4"
},
{
question: "Capital of France?",
answers: ["London", "Paris", "Berlin", "Rome"],
correct: "Paris"
},
{
question: "Largest planet in our solar system?",
answers: ["Earth", "Mars", "Jupiter", "Saturn"],
correct: "Jupiter"
}
];

var currentIndex = 0;
var playerName = "";
var countdownInterval;
var timeLeft = 15;
var questionStartTime;
var webAppUrl = localStorage.getItem('webAppUrl') || '';

// Initialize the application
function initApp() {
// Set web app URL if available
if (webAppUrl) {
document.getElementById('webAppUrl').value = webAppUrl;
document.getElementById('urlStatus').textContent = 'Web App URL loaded from storage';
document.getElementById('urlStatus').className = 'url-status success';
}

// Set up join button
document.getElementById("joinBtn").onclick = function() {
playerName = document.getElementById("name").value;
if (playerName.trim() !== "") {
// Remove the welcome message by hiding the input elements
document.getElementById("name").style.display = "none";
document.getElementById("joinBtn").style.display = "none";

// Show first question
showPlayerQuestion();
} else {
alert("Please enter your name to join the game.");
}
};

// Update quiz time info
updateQuizTimeInfo();
}

// Save web app URL to local storage
function saveWebAppUrl() {
var url = document.getElementById('webAppUrl').value;
var urlStatus = document.getElementById('urlStatus');

if (url) {
// Basic validation for Google Apps Script URL
if (!url.includes('https://script.google.com/')) {
urlStatus.textContent = 'URL should be a Google Apps Script URL';
urlStatus.className = 'url-status error';
return;
}

localStorage.setItem('webAppUrl', url);
webAppUrl = url;

urlStatus.textContent = 'URL saved successfully! Setup complete.';
urlStatus.className = 'url-status success';

// Hide setup form and show completion message
document.getElementById('setup-form').style.display = 'none';
document.getElementById('setup-complete-message').style.display = 'block';
} else {
urlStatus.textContent = 'Please enter a valid URL';
urlStatus.className = 'url-status error';
}
}

// Function to send data to Google Sheets
function sendToGoogleSheet(playerName, question, selectedAnswer, correctAnswer, responseTime, status) {
// Use the webAppUrl from the variable
if (!webAppUrl) {
console.error("Web app URL not configured");
alert("Google Sheets integration not configured. Please set up the web app URL in the Setup tab.");
switchTab('setup');
return false;
}

// Prepare data to send
var data = {
player: playerName,
question: question,
answer: selectedAnswer,
correct: correctAnswer,
responseTime: responseTime,
status: status
};

console.log("Sending data to Google Sheets:", data);

// Send data to Google Apps Script web app
// Using a proxy approach to avoid CORS issues
return fetch('https://corsproxy.io/?' + encodeURIComponent(webAppUrl), {
method: "POST",
headers: {
"Content-Type": "application/json"
},
body: JSON.stringify(data)
})
.then(response => {
if (!response.ok) {
throw new Error('Network response was not ok');
}
return response.json();
})
.then(data => {
console.log("Data sent to Google Sheets successfully:", data);
return true;
})
.catch(error => {
console.error("Error sending data to Google Sheets:", error);

// Fallback: Try direct connection (might work in some environments)
return fetch(webAppUrl, {
method: "POST",
headers: {
"Content-Type": "application/json"
},
body: JSON.stringify(data),
mode: 'no-cors'
})
.then(() => {
console.log("Data sent with no-cors mode (response not readable)");
return true;
})
.catch(fallbackError => {
console.error("Fallback also failed:", fallbackError);
alert("Failed to send data to Google Sheets. Check console for details.");
return false;
});
});
}

// Test Google Sheets connection
function testGoogleSheetsConnection() {
var statusElement = document.getElementById('testConnectionStatus');
statusElement.textContent = "Testing connection...";
statusElement.className = 'url-status';

if (!webAppUrl) {
statusElement.textContent = 'Web App URL not configured';
statusElement.className = 'url-status error';
return;
}

// Test with a GET request (doGet function in Apps Script)
fetch('https://corsproxy.io/?' + encodeURIComponent(webAppUrl))
.then(response => response.json())
.then(data => {
statusElement.textContent = 'Connection successful: ' + data.message;
statusElement.className = 'url-status success';
})
.catch(error => {
statusElement.textContent = 'Connection failed: ' + error.message;
statusElement.className = 'url-status error';
console.error("Connection test error:", error);
});
}

// Send sample data to Google Sheets
function sendSampleData() {
var statusElement = document.getElementById('sampleDataStatus');
statusElement.textContent = "Sending sample data...";
statusElement.className = 'url-status';

sendToGoogleSheet(
"Test Player",
"Sample question for testing",
"Sample answer",
"Correct answer",
5.2,
"Test"
).then(success => {
if (success) {
statusElement.textContent = 'Sample data sent successfully!';
statusElement.className = 'url-status success';
} else {
statusElement.textContent = 'Failed to send sample data';
statusElement.className = 'url-status error';
}
});
}

// Countdown timer function
function startCountdown() {
timeLeft = 15;
document.getElementById('countdown').textContent = `Time left: ${timeLeft}s`;

clearInterval(countdownInterval);
countdownInterval = setInterval(() => {
timeLeft--;
document.getElementById('countdown').textContent = `Time left: ${timeLeft}s`;

if (timeLeft <= 0) {
clearInterval(countdownInterval);
// Record unanswered question
var q = questions[currentIndex];
var responseTime = (Date.now() - questionStartTime) / 1000;
sendToGoogleSheet(playerName, q.question, "No Answer", q.correct, responseTime, "Unanswered");
moveToNextQuestion();
}
}, 1000);
}

// Move to next question automatically
function moveToNextQuestion() {
currentIndex++;
if (currentIndex < questions.length) {
showPlayerQuestion();
} else {
document.getElementById('player-question').innerHTML = "<h3>Quiz Completed!</h3><p>Thank you for playing. Your answers have been recorded.</p>";
document.getElementById('player-answers').innerHTML = "";
document.getElementById('countdown').textContent = "";
}
}

// Player view functions
function showPlayerQuestion() {
var q = questions[currentIndex];
document.getElementById("player-question").innerHTML = "<h3>Question " + (currentIndex + 1) + ":</h3><p>" + q.question + "</p>";

var answersDiv = document.getElementById("player-answers");
answersDiv.innerHTML = "<h3>Select your answer:</h3>";

// Record question start time for response timing
questionStartTime = Date.now();

q.answers.forEach(a => {
var btn = document.createElement("button");
btn.className = "answer-btn";
btn.innerText = a;
btn.onclick = function() {
var selected = a;
var correct = q.correct;
var responseTime = (Date.now() - questionStartTime) / 1000; // Response time in seconds

// Clear the countdown
clearInterval(countdownInterval);
document.getElementById('countdown').textContent = "";

// Color the answers
var allButtons = document.querySelectorAll('.answer-btn');
allButtons.forEach(button => {
button.disabled = true;
if (button.innerText === correct) {
button.classList.add('correct');
} else if (button.innerText === selected && selected !== correct) {
button.classList.add('incorrect');
}
});

// Send to Google Sheets with response time
sendToGoogleSheet(playerName, q.question, selected, correct, responseTime, selected === correct ? "Correct" : "Incorrect");

// Move to next question after 3 seconds
setTimeout(moveToNextQuestion, 3000);
};
answersDiv.appendChild(btn);
});

// Start countdown for this question
startCountdown();
}

// Update quiz time info display
function updateQuizTimeInfo() {
document.getElementById('quiz-time-range').textContent = "Anytime";
document.getElementById('quiz-status-text').textContent = "Ready to play";
document.getElementById('quiz-status-text').style.color = '#4caf50';
document.getElementById('quiz-timer').textContent = "Quiz: Ready";
}

// Initialize the application when page loads
window.onload = initApp;
</script>
</body>
</html>
